<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>User Dashboard • Myopia Study</title>

    <!-- Fonts: Inter for a clean, modern look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

    <!-- Bootstrap 5 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />


    <link rel="stylesheet" href="static/css/user_dash.css" />
</head>

<body>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay"></div>

    <!-- SIDEBAR -->
    <aside id="sidebar">
        <button class="btn-close-sidebar"><i class="fa-solid fa-xmark"></i></button>
        <div class="sidebar-brand">
            <div class="bg-primary bg-gradient rounded-4 p-2 d-flex align-items-center justify-content-center text-white shadow-sm"
                style="width: 44px; height: 44px;">
                <i class="fa-solid fa-eye fs-5"></i>
            </div>
            <span class="fs-5">Myopia Study</span>
        </div>

        <nav class="flex-column mt-4 px-3">
            <div class="small fw-bold text-uppercase text-muted mb-3 px-3"
                style="font-size: 0.75rem; letter-spacing: 0.08em;">Main Menu</div>

            <!-- Dashboard -->
            <div class="nav-link active" onclick="showSection('dashboard', this)">
                <i class="bi bi-grid-1x2-fill"></i>
                <span>Dashboard</span>
            </div>

            <!-- Students -->
            <div class="nav-link" onclick="showSection('patients', this)">
                <i class="bi bi-people-fill"></i>
                <span>Registered Students</span>
            </div>

            <!-- New Entry -->
            <div class="nav-link" onclick="showSection('forms', this)">
                <i class="bi bi-file-earmark-medical-fill"></i>
                <span>New Survey</span>
            </div>

            <!-- Follow-Ups -->
            <div class="nav-link" onclick="showSection('followups', this)">
                <i class="bi bi-calendar-check-fill"></i>
                <span>Follow-Ups</span>
            </div>
        </nav>

        <div class="mt-auto border-top border-light p-4">
            <div class="d-flex align-items-center gap-3 mb-4">
                <img src="https://ui-avatars.com/api/?name=Dr+Clinician&background=0ea5e9&color=fff&size=128"
                    class="rounded-circle shadow-sm" width="40" height="40">
                <div style="line-height: 1.2;">
                    <div class="fw-bold text-dark fs-6">Dr. Clinician</div>
                    <small class="text-muted fw-medium" style="font-size: 0.8rem;">Ophthalmologist</small>
                </div>
            </div>
            <button class="btn btn-light w-100 text-danger fw-bold justify-content-center" onclick="submitLogout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </aside>


    <!-- MAIN WRAPPER -->
    <div id="content-wrapper">

        <!-- TOP NAVBAR -->
        <nav class="main-navbar">
            <div class="d-flex align-items-center">
                        <!-- Mobile Toggle -->
                        <button class="btn btn-light d-lg-none me-3" id="mobileSidebarToggle">
                            <i class="fa fa-bars"></i>
                        </button>
                                <!-- Desktop Toggle -->
                                <button class="btn btn-light d-none d-lg-block me-3" id="desktopSidebarToggle">
                                    <i class="fa-solid fa-bars-staggered"></i>
                                </button>                        <h5 class="mb-0 fw-bold d-none d-sm-block text-secondary fs-6">                    <i class="bi bi-house-door me-2"></i>Research Portal
                </h5>
            </div>

            <div class="d-flex align-items-center gap-4">
                <button class="btn btn-light rounded-circle p-0 d-flex align-items-center justify-content-center"
                    style="width: 38px; height: 38px;">
                    <i class="bi bi-bell"></i>
                </button>
                <!-- Profile Dropdown -->
                <div class="dropdown">
                    <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle text-dark"
                        id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <span id="welcomeUser" class="me-2 small fw-semibold text-muted d-none d-md-inline">Welcome,
                            Doc</span>
                        <i class="bi bi-chevron-down small text-muted"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg mt-2 p-2 rounded-4"
                        aria-labelledby="profileDropdown">
                        <li>
                            <h6 class="dropdown-header">My Account</h6>
                        </li>
                        <li><a class="dropdown-item rounded-2 py-2" href="#" onclick="openEditProfile()"><i
                                    class="bi bi-person me-2"></i>Profile</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item rounded-2 py-2 text-danger" href="#" onclick="submitLogout()"><i
                                    class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </nav>


        <!-- CONTENT AREA -->
        <div id="content">

            <!-- ===================== DASHBOARD ===================== -->
            <section id="dashboard" class="spa-section active">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-5">
                    <div class="mb-4 mb-md-0">
                        <h2 class="section-title">Dashboard Overview</h2>
                        <p class="text-muted m-0 fs-6">Welcome back! Here's your study progress for today.</p>
                    </div>
                    <button class="btn btn-primary"
                        onclick="showSection('forms', document.querySelector('div[onclick*=forms]'))">
                        <i class="bi bi-plus-lg"></i>
                        <span>New Clinical Entry</span>
                    </button>
                </div>

                <!-- Metrics Grid -->
                <div class="row g-4 mb-5">
                    <!-- Total Students -->
                    <div class="col-md-6 col-lg-3 metric-card-wrapper">
                        <div class="card h-100 border-0">
                            <div class="card-body metric-card">
                                <div class="metric-icon bg-soft-blue">
                                    <i class="bi bi-people-fill"></i>
                                </div>
                                <div>
                                    <h3 class="fw-bold mb-1 text-dark" id="totalStudents"></h3>
                                    <span class="text-muted fw-medium small">Total Students</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Follow-ups Due -->
                    <div class="col-md-6 col-lg-3 metric-card-wrapper">
                        <div class="card h-100 border-0">
                            <div class="card-body metric-card">
                                <div class="metric-icon bg-soft-orange">
                                    <i class="bi bi-exclamation-diamond-fill"></i>
                                </div>
                                <div>
                                    <h3 class="fw-bold mb-1 text-dark" id="followupsDue">--</h3>
                                    <span class="text-muted fw-medium small">Action Required</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Total Follow-ups -->
                    <div class="col-md-6 col-lg-3 metric-card-wrapper">
                        <div class="card h-100 border-0">
                            <div class="card-body metric-card">
                                <div class="metric-icon bg-soft-purple">
                                    <i class="bi bi-calendar2-check-fill"></i>
                                </div>
                                <div>
                                    <h3 class="fw-bold mb-1 text-dark" id="totalFollowups"></h3>
                                    <span class="text-muted fw-medium small">Total Follow-ups</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Entries -->
                    <div class="col-md-6 col-lg-3 metric-card-wrapper">
                        <div class="card h-100 border-0">
                            <div class="card-body metric-card">
                                <div class="metric-icon bg-soft-green">
                                    <i class="bi bi-file-earmark-plus-fill"></i>
                                </div>
                                <div>
                                    <h3 class="fw-bold mb-1 text-dark" id="todayEntries">--</h3>
                                    <span class="text-muted fw-medium small">Entries Today</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card border-0 bg-transparent shadow-none">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 class="fw-bold text-dark m-0">Recent Activity</h4>
                        <div class="input-group bg-white rounded-3 shadow-sm border"
                            style="width: 300px; overflow: hidden;">
                            <span class="input-group-text bg-white border-0 ps-3"><i
                                    class="bi bi-search text-muted"></i></span>
                            <input type="text" id="recentSearchInput" class="form-control border-0 bg-white shadow-none"
                                placeholder="Search activity...">
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th class="ps-4">Student Name</th>
                                    <th>Activity</th>
                                    <th>Date</th>
                                    <th class="text-end pe-4">Action</th>
                                </tr>
                            </thead>
                            <tbody id="recentActivityList">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-5">
                        <small class="text-muted fw-medium" id="recentPaginationInfo"></small>
                        <div class="btn-group shadow-sm">
                            <button class="btn btn-white border px-3" id="recentPrevBtn" onclick="prevRecentPage()"><i
                                    class="bi bi-chevron-left"></i></button>
                            <button class="btn btn-white border px-3" id="recentNextBtn" onclick="nextRecentPage()"><i
                                    class="bi bi-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ===================== STUDENTS ===================== -->
            <section id="patients" class="spa-section">
                <div class="d-flex align-items-center justify-content-between mb-5">
                    <div>
                        <h2 class="section-title mb-2">Student Management</h2>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#"
                                        onclick="showSection('dashboard', document.querySelector('div[onclick*=dashboard]'))">Dashboard</a>
                                </li>
                                <li class="breadcrumb-item active">Students</li>
                            </ol>
                        </nav>
                    </div>
                </div>

                <div class="card border-0 bg-transparent shadow-none">
                    <div class="card mb-5 border-0 shadow-sm">
                        <div class="card-body p-4">
                            <div class="row g-4">
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <span class="input-group-text bg-white border-end-0 ps-3"><i
                                                class="bi bi-search text-muted"></i></span>
                                        <input type="text" id="patientSearchInput"
                                            class="form-control border-start-0 ps-1 bg-white shadow-none"
                                            placeholder="Search students...">
                                    </div>
                                </div>
                                <div class="col-md-8 text-end">
                                    <div class="dropdown d-inline-block">
                                        <button class="btn btn-white border shadow-sm dropdown-toggle" type="button"
                                            data-bs-toggle="dropdown">
                                            <i class="bi bi-funnel me-2"></i> Filters
                                        </button>
                                        <div class="dropdown-menu p-3 shadow-lg border-0 rounded-4"
                                            style="min-width: 300px;">
                                            <div class="mb-3">
                                                <label class="small fw-bold mb-2">School</label>
                                                <input type="text" id="schoolFilter" class="form-control">
                                            </div>
                                            <div class="mb-3">
                                                <label class="small fw-bold mb-2">Gender</label>
                                                <select id="genderFilter" class="form-select">
                                                    <option value="">All</option>
                                                    <option value="Male">Male</option>
                                                    <option value="Female">Female</option>
                                                </select>
                                            </div>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-primary" onclick="applyPatientFilters()">Apply
                                                    Filters</button>
                                                <button class="btn btn-light"
                                                    onclick="clearPatientFilters()">Reset</button>
                                            </div>
                                            <!-- Hidden date inputs for JS compat -->
                                            <input type="hidden" id="dateFromFilter">
                                            <input type="hidden" id="dateToFilter">
                                            <input type="hidden" id="dateFilter">
                                            <input type="hidden" id="ageFilter">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-custom" id="patientsTable">
                            <thead>
                                <tr>
                                    <th class="ps-4">Student</th>
                                    <th>School</th>
                                    <th>Age</th>
                                    <th>Gender</th>
                                    <th>Last Visit</th>
                                    <th class="text-end pe-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-5">
                        <small class="text-muted fw-medium" id="patientPaginationInfo">Showing 0 entries</small>
                        <div class="btn-group shadow-sm">
                            <button class="btn btn-white border px-3" id="patientPrevBtn" onclick="prevPatientPage()"><i
                                    class="bi bi-chevron-left"></i></button>
                            <button class="btn btn-white border px-3" id="patientNextBtn" onclick="nextPatientPage()"><i
                                    class="bi bi-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ===================== FORMS (NEW ENTRY) ===================== -->
            <section id="forms" class="spa-section">

                <!-- List View State -->
                <div id="formsListState">
                    <div class="d-flex justify-content-between align-items-center mb-5">
                        <div>
                            <h2 class="section-title mb-2">Clinical Entries</h2>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#"
                                            onclick="showSection('dashboard', document.querySelector('div[onclick*=dashboard]'))">Dashboard</a>
                                    </li>
                                    <li class="breadcrumb-item active">Entries</li>
                                </ol>
                            </nav>
                        </div>
                        <button class="btn btn-primary shadow-sm" onclick="switchFormState('entry')">
                            <i class="fas fa-plus me-2"></i>New Entry
                        </button>
                    </div>

                    <div class="card border-0 bg-transparent shadow-none">
                        <div class="card mb-5 border-0 shadow-sm">
                            <div class="card-body p-4">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="input-group">
                                            <span class="input-group-text bg-white border-end-0 ps-3"><i
                                                    class="bi bi-search text-muted"></i></span>
                                            <input type="text" id="searchInput"
                                                class="form-control border-start-0 bg-white shadow-none"
                                                placeholder="Search entries...">
                                        </div>
                                    </div>
                                    <!-- Hidden filters for compatibility -->
                                    <input type="hidden" id="statusFilter">
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-custom" id="formsTable">
                                <thead>
                                    <tr>
                                        <th class="ps-4">ID</th>
                                        <th>Date Submitted</th>
                                        <th>Student Name</th>
                                        <th>School</th>
                                        <th>Status</th>
                                        <th class="text-end pe-4">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-5">
                            <small class="text-muted fw-medium" id="paginationInfo"></small>
                            <div class="btn-group shadow-sm">
                                <button class="btn btn-white border px-3" id="prevBtn"
                                    onclick="prevPage()">Prev</button>
                                <button class="btn btn-white border px-3" id="nextBtn"
                                    onclick="nextPage()">Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Entry Form State -->
                <div id="formsEntryState" style="display: none;">
                    <div class="d-flex align-items-center mb-5">
                        <button class="btn btn-white border shadow-sm me-4 px-3" onclick="switchFormState('list')">
                            <i class="fa fa-arrow-left"></i>
                        </button>
                        <div>
                            <h3 class="fw-bold mb-1 text-dark" id="formEntryTitle">New Clinical Entry</h3>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#"
                                            onclick="showSection('dashboard', document.querySelector('div[onclick*=dashboard]'))">Dashboard</a>
                                    </li>
                                    <li class="breadcrumb-item"><a href="#"
                                            onclick="switchFormState('list')">Entries</a></li>
                                    <li class="breadcrumb-item active">New Form</li>
                                </ol>
                            </nav>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-5">
                            <div class="text-center mb-5">
                                <div class="d-inline-flex align-items-center justify-content-center bg-soft-blue text-primary rounded-circle mb-4"
                                    style="width: 72px; height: 72px; font-size: 1.8rem;">
                                    <i class="bi bi-clipboard2-pulse-fill"></i>
                                </div>
                                <h4 class="fw-bold text-dark fs-3">Myopia Progression Study Questionnaire</h4>
                                <p class="text-muted fs-6">School-Going Children (Age 6–18 Years)</p>
                            </div>

                            <form id="myopiaForm" class="needs-validation" novalidate>
                                <div class="accordion" id="myopiaFormAccordion">

                                    <!-- Section A -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingA">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                                data-bs-target="#collapseA">
                                                <div class="d-flex align-items-center">
                                                    <div class="rounded-circle bg-soft-blue text-primary d-flex align-items-center justify-content-center me-3"
                                                        style="width: 36px; height: 36px;">
                                                        <i class="bi bi-person-fill"></i>
                                                    </div>
                                                    <span>Section A: Demographic Information</span>
                                                </div>
                                            </button>
                                        </h2>
                                        <div id="collapseA" class="accordion-collapse collapse show"
                                            data-bs-parent="#myopiaFormAccordion">
                                            <div class="accordion-body bg-white p-4">
                                                <div class="row g-4">
                                                    <div class="col-md-6">
                                                        <label class="form-label">Name of Student</label>
                                                        <input type="text" class="form-control" name="name" required>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">School Name</label>
                                                        <input type="text" class="form-control" name="school_name">
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Age (years)</label>
                                                        <input type="number" class="form-control" name="age" min="1"
                                                            required>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Gender</label>
                                                        <select class="form-select" name="gender" required>
                                                            <option value="">Select</option>
                                                            <option value="Male">Male</option>
                                                            <option value="Female">Female</option>
                                                            <option value="Other">Other</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Height (cm)</label>
                                                        <input type="number" class="form-control" name="height"
                                                            step="0.1">
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Weight (kg)</label>
                                                        <input type="number" class="form-control" name="weight"
                                                            step="0.1">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">Parental Myopia</label>
                                                        <div class="d-flex gap-4 pt-2">
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio"
                                                                    name="parental_myopia" value="None"> <label
                                                                    class="form-check-label">None</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio"
                                                                    name="parental_myopia" value="Father"> <label
                                                                    class="form-check-label">Father</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio"
                                                                    name="parental_myopia" value="Mother"> <label
                                                                    class="form-check-label">Mother</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio"
                                                                    name="parental_myopia" value="Both"> <label
                                                                    class="form-check-label">Both</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Siblings (Count)</label>
                                                        <input type="number" class="form-control" name="num_siblings"
                                                            min="0">
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Birth Order</label>
                                                        <select class="form-select" name="birth_order">
                                                            <option value="">Select</option>
                                                            <option value="First">First</option>
                                                            <option value="Second">Second</option>
                                                            <option value="Third">Third</option>
                                                            <option value="Only">Only Child</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Siblings with Myopia</label>
                                                        <input type="number" class="form-control" name="siblings_myopia"
                                                            min="0">
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                                                    <button type="button" class="btn btn-light px-4"
                                                        onclick="resetSection('A')">Reset</button>
                                                    <button type="button" class="btn btn-primary px-5"
                                                        onclick="saveSection('A')">Save Progress</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section B -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingB">
                                            <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#collapseB">
                                                <div class="d-flex align-items-center">
                                                    <div class="rounded-circle bg-soft-orange text-orange d-flex align-items-center justify-content-center me-3"
                                                        style="width: 36px; height: 36px; color: var(--accent-color); background: var(--accent-light);">
                                                        <i class="bi bi-activity"></i>
                                                    </div>
                                                    <span>Section B: Behavioral & Lifestyle</span>
                                                </div>
                                            </button>
                                        </h2>
                                        <div id="collapseB" class="accordion-collapse collapse"
                                            data-bs-parent="#myopiaFormAccordion">
                                            <div class="accordion-body bg-white p-4">
                                                <div class="row g-4">
                                                    <div class="col-md-6"><label class="form-label">10. Time of Daily
                                                            Outdoor Activity</label><input type="time"
                                                            class="form-control" name="outdoor_time"></div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">11. Duration of Outdoor
                                                            Activity</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="outdoor_duration" value="<1 hr"
                                                                    class="form-check-input"> &lt;1 hr</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="outdoor_duration" value="1-2 hrs"
                                                                    class="form-check-input"> 1–2 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="outdoor_duration" value="2-4 hrs"
                                                                    class="form-check-input"> 2–4 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="outdoor_duration" value=">4 hrs"
                                                                    class="form-check-input"> &gt;4 hrs</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">12. Sun Exposure during
                                                            Outdoor Activity</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="sun_exposure" value="<1 hr"
                                                                    class="form-check-input"> Bright Sunlight</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sun_exposure" value="1-3 hrs"
                                                                    class="form-check-input"> Partial Sunlight</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sun_exposure" value="3-5 hrs"
                                                                    class="form-check-input"> Shade</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">13. Weekly Frequency of
                                                            Sports/Extracurricular Activities</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="sports_activity" value="<1 hr"
                                                                    class="form-check-input"> Everyday</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sports_activity" value="1-3 hrs"
                                                                    class="form-check-input"> Alternate day</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sports_activity" value="3-5 hrs"
                                                                    class="form-check-input"> Weekends</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sports_activity" value="3-5 hrs"
                                                                    class="form-check-input"> Occasionally</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">14. Near-Work
                                                            Activities</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_activity" value="<1 hr"
                                                                    class="form-check-input"> Reading</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_activity" value="1-3 hrs"
                                                                    class="form-check-input"> Writing</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_activity" value="3-5 hrs"
                                                                    class="form-check-input"> Both</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">15. Hours of
                                                            Near-Work</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_hours" value="<1 hr"
                                                                    class="form-check-input"> &lt;1 hr</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_hours" value="1-3 hrs"
                                                                    class="form-check-input"> 1-3 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_hours" value="3-5 hrs"
                                                                    class="form-check-input"> 3-5 hrs</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">16. Daily Screen
                                                            Time</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="screen_time" value="<1 hr"
                                                                    class="form-check-input"> &lt;1 hr</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="screen_time" value="1-3 hrs"
                                                                    class="form-check-input"> 1-3 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="screen_time" value="3-5 hrs"
                                                                    class="form-check-input"> 3-5 hrs</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">17. Primary Device
                                                            Usage</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="primary_device" value="<1 hr"
                                                                    class="form-check-input"> Television</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="primary_device" value="1-3 hrs"
                                                                    class="form-check-input"> Smartphone</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="primary_device" value="3-5 hrs"
                                                                    class="form-check-input"> Tablet</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="primary_device" value="3-5 hrs"
                                                                    class="form-check-input"> Computer</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">18. Reading Distance</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="reading_distance" value="<1 hr"
                                                                    class="form-check-input"> &lt;15 cm</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="reading_distance" value="1-3 hrs"
                                                                    class="form-check-input"> 15-30 cm</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="reading_distance" value="3-5 hrs"
                                                                    class="form-check-input"> &gt;30 cm</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">19. Ratio of Correct
                                                            Book-Holding Posture</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="book_holding_posture" value="<1 hr"
                                                                    class="form-check-input"> 1/4th</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="book_holding_posture" value="1-3 hrs"
                                                                    class="form-check-input"> 2/4th</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="book_holding_posture" value="3-5 hrs"
                                                                    class="form-check-input"> 3/4th</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="book_holding_posture" value="3-5 hrs"
                                                                    class="form-check-input"> 4/4th</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">20. Average Sleep
                                                            Duration</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="sleep_duration" value="<1 hr"
                                                                    class="form-check-input"> &lt;6 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sleep_duration" value="1-3 hrs"
                                                                    class="form-check-input"> 6-8 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sleep_duration" value="3-5 hrs"
                                                                    class="form-check-input"> &gt;8 hrs</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">21. Usual Bedtime</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="usual_bedtime" value="<1 hr"
                                                                    class="form-check-input"> 8-10 PM</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="usual_bedtime" value="1-3 hrs"
                                                                    class="form-check-input"> 10-12 AM</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="usual_bedtime" value="3-5 hrs"
                                                                    class="form-check-input"> &gt;12 AM</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">22. Dietary Habits</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="dietary_habits" value="<1 hr"
                                                                    class="form-check-input"> Veg</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="dietary_habits" value="1-3 hrs"
                                                                    class="form-check-input"> Non-Veg</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="dietary_habits" value="3-5 hrs"
                                                                    class="form-check-input"> Mixed</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 mt-4">
                                                        <div
                                                            class="alert alert-info border-0 bg-soft-blue small mb-0 p-3 rounded-3">
                                                            <i class="bi bi-info-circle-fill me-2"></i> Ensure all
                                                            lifestyle questions are asked during the interview.
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                                                    <button type="button" class="btn btn-light px-4"
                                                        onclick="resetSection('B')">Reset</button>
                                                    <button type="button" class="btn btn-primary px-5"
                                                        onclick="saveSection('B')">Save Progress</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section C -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingC">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapseC">
                                            <div class="d-flex align-items-center">
                                                <div class="rounded-circle text-green d-flex align-items-center justify-content-center me-3"
                                                    style="width: 36px; height: 36px; color: var(--accent-color); background: var(--accent-light);">
                                                    <i class="bi bi-tree"></i>
                                                </div>
                                                <span>Section C: Environmental Factors</span>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapseC" class="accordion-collapse collapse"
                                        data-bs-parent="#myopiaFormAccordion">
                                        <div class="accordion-body bg-white p-4">
                                            <!-- Hidden fields present for JS to find -->
                                            <div class="row g-4">
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">23. School Type</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio" name="school_type"
                                                                value="Urban" class="form-check-input"> Urban</div>
                                                        <div class="form-check"><input type="radio" name="school_type"
                                                                value="Rural" class="form-check-input"> Rural</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">24. Classroom
                                                        Seating</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_seating" value="Urban"
                                                                class="form-check-input"> Front</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_seating" value="Rural"
                                                                class="form-check-input"> Middle</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_seating" value="Rural"
                                                                class="form-check-input"> Back</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">25. Seating Position in
                                                        Classroom</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio"
                                                                name="seating_position" value="Urban"
                                                                class="form-check-input"> Window</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="seating_position" value="Rural"
                                                                class="form-check-input"> Aisle</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="seating_position" value="Rural"
                                                                class="form-check-input"> Center</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">26. Teaching
                                                        Methodology</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio"
                                                                name="teaching_methodology" value="Urban"
                                                                class="form-check-input"> Blackboard</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="teaching_methodology" value="Rural"
                                                                class="form-check-input"> Audiovisual</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">27. Type of lighting in
                                                        Classroom</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_lighting" value="Urban"
                                                                class="form-check-input"> Fluorescent</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_lighting" value="Rural"
                                                                class="form-check-input"> Incandescent</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_lighting" value="Rural"
                                                                class="form-check-input"> LED</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_lighting" value="Rural"
                                                                class="form-check-input"> Natural</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">28. Type of lighting at
                                                        Home</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio" name="home_lighting"
                                                                value="Urban" class="form-check-input"> Fluorescent
                                                        </div>
                                                        <div class="form-check"><input type="radio" name="home_lighting"
                                                                value="Rural" class="form-check-input"> Incandescent
                                                        </div>
                                                        <div class="form-check"><input type="radio" name="home_lighting"
                                                                value="Rural" class="form-check-input"> LED</div>
                                                        <div class="form-check"><input type="radio" name="home_lighting"
                                                                value="Rural" class="form-check-input"> Natural</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">29. Sunlight in
                                                        Classroom</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio"
                                                                name="sunlight_in_classroom" value="Urban"
                                                                class="form-check-input"> Direct</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="sunlight_in_classroom" value="Rural"
                                                                class="form-check-input"> Indirect</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                                                <button type="button" class="btn btn-primary px-5"
                                                    onclick="saveSection('C')">Save Progress</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section D -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingD">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapseD">
                                            <div class="d-flex align-items-center">
                                                <div class="rounded-circle text-purple d-flex align-items-center justify-content-center me-3"
                                                    style="width: 36px; height: 36px; color: var(--accent-color); background: var(--accent-light);">
                                                    <i class="bi bi-clock-history"></i>
                                                </div>
                                                <span>Section D: Clinical History</span>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapseD" class="accordion-collapse collapse"
                                        data-bs-parent="#myopiaFormAccordion">
                                        <div class="accordion-body p-4">
                                            <div class="row g-4">
                                                <div class="col-md-6">
                                                    <label class="form-label">30. Age of Onset of Myopia</label>
                                                    <input type="number" class="form-control"
                                                        name="age_of_onset_of_myopia">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">31. Duration of Myopia</label>
                                                    <input type="text" class="form-control" name="duration_of_myopia">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">32. Duration of Spectacle
                                                        Usage</label>
                                                    <input type="text" class="form-control"
                                                        name="spectacle_usage_duration">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">33. Previous Spectacle Power</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="previous_spectacle_power_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="previous_spectacle_power_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">34. Frequency of Spectacle
                                                        Change</label>
                                                    <div class="d-flex flex-wrap gap-3 pt-2">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="spectacle_change_frequency" value="<6 months">
                                                            &lt;6 months
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="spectacle_change_frequency" value="6-12 months">
                                                            6-12 months
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="spectacle_change_frequency" value=">12 months">
                                                            &gt;12 months
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">35. Family History of Myopia
                                                        (Relation)</label>
                                                    <input type="text" class="form-control"
                                                        name="family_history_of_myopia_relation">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">36. Any other Ocular
                                                        Conditions</label>
                                                    <div class="d-flex flex-wrap gap-3 pt-2">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="any_other_ocular_conditions" value="Yes">
                                                            Yes
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="any_other_ocular_conditions" value="No">
                                                            No
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">If Yes, Specify</label>
                                                    <input type="text" class="form-control"
                                                        name="any_other_ocular_conditions_specify">
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                                                <button type="button" class="btn btn-primary px-5"
                                                    onclick="saveSection('D')">Save</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section E -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingE">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapseE">
                                            <div class="d-flex align-items-center">
                                                <div class="rounded-circle text-info d-flex align-items-center justify-content-center me-3"
                                                    style="width: 36px; height: 36px; color: var(--accent-color); background: var(--accent-light);">
                                                    <i class="bi bi-shield-check"></i>
                                                </div>
                                                <span>Section E: Awareness & Safety</span>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapseE" class="accordion-collapse collapse"
                                        data-bs-parent="#myopiaFormAccordion">
                                        <div class="accordion-body p-4">
                                            <div class="d-none">
                                                <input type="radio" name="access_to_vision_care" value="true">
                                                <input type="radio" name="aware_eye_strain" value="true">
                                                <input type="radio" name="follows_preventive_measures" value="Always">
                                                <input type="checkbox" name="source_of_awareness" value="School">
                                                <input name="source_other">
                                            </div>
                                            <button type="button" class="btn btn-primary px-5"
                                                onclick="saveSection('E')">Save</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section F: Critical Ocular Data -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingF">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapseF">
                                            <div class="d-flex align-items-center">
                                                <div class="rounded-circle text-danger d-flex align-items-center justify-content-center me-3"
                                                    style="width: 36px; height: 36px; color: var(--accent-color); background: var(--accent-light);">
                                                    <i class="bi bi-eye-fill"></i>
                                                </div>
                                                <span>Section F: Ocular Examination</span>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapseF" class="accordion-collapse collapse"
                                        data-bs-parent="#myopiaFormAccordion">
                                        <div class="accordion-body bg-white p-4">
                                            <div class="row g-4">
                                                <div class="col-md-6">
                                                    <label class="form-label">37. Uncorrected Visual Acuity</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="uncorrected_visual_acuity_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="uncorrected_visual_acuity_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">38. Best Corrected Visual
                                                        Acuity</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="best_corrected_visual_acuity_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="best_corrected_visual_acuity_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">39. Cycloplegic Refraction</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="cycloplegic_refraction_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="cycloplegic_refraction_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">40. Axial Length</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="axial_length_right_eye" placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="axial_length_left_eye" placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">41. Keratometry</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="keratometry_right_eye" placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="keratometry_left_eye" placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">42. Anterior Chamber Depth</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="anterior_chamber_depth_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="anterior_chamber_depth_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">43. Lens Thickness</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="lens_thickness_right_eye" placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="lens_thickness_left_eye" placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">44. Central Corneal Thickness</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="central_corneal_thickness_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="central_corneal_thickness_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">45. Intraocular Pressure</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="intraocular_pressure_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="intraocular_pressure_left_eye" placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">46. Retinal Thickness (Macular)</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="retinal_thickness_macular_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="retinal_thickness_macular_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">47. Choroidal Thickness
                                                        (Macular)</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="choroidal_thickness_macular_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="choroidal_thickness_macular_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">48. Peripapillary RNFL
                                                        Thickness</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="peripapillary_rnfl_thickness_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="peripapillary_rnfl_thickness_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                                                <button type="button" class="btn btn-primary px-5"
                                                    onclick="saveSection('F')">Save Progress</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                        </div> <!-- End Accordion -->

                        <div id="formSubmitBtnContainer" class="d-grid gap-2 mt-5" style="display:none;">
                            <button class="btn btn-success btn-lg shadow py-3 fw-bold fs-6" type="submit"
                                onclick="submitForm()">
                                <i class="bi bi-check-circle-fill me-2"></i> Submit Final Data
                            </button>
                        </div>
                        </form>
                    </div>
                </div>
        </div>

        <!-- Success State -->
        <div id="formsSuccessState" style="display: none;">
            <div class="text-center py-5">
                <div class="display-1 text-success mb-3"><i class="bi bi-check-circle"></i></div>
                <h2 class="fw-bold mb-2">Submitted Successfully!</h2>
                <p class="text-muted fs-5">Data has been securely recorded.</p>
                <div class="bg-white border rounded-4 p-4 d-inline-block my-5 shadow-sm">
                    <small class="text-uppercase text-muted fw-bold">Reference ID</small>
                    <div class="fs-2 fw-bold text-dark mt-1" id="successFormId"></div>
                </div>
                <br>
                <button class="btn btn-outline-primary px-5 me-2 py-3" onclick="switchFormState('list')">Return
                    to List</button>
                <button class="btn btn-primary px-5 py-3" onclick="switchFormState('entry')">Submit
                    Another</button>
            </div>
        </div>
        </section>

        <!-- ===================== FOLLOW-UPS ===================== -->
        <section id="followups" class="spa-section">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <div>
                    <h2 class="section-title mb-2">Follow-Up Management</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#"
                                    onclick="showSection('dashboard', document.querySelector('div[onclick*=dashboard]'))">Dashboard</a>
                            </li>
                            <li class="breadcrumb-item active">Follow-Ups</li>
                        </ol>
                    </nav>
                </div>
                <button class="btn btn-primary shadow-sm" onclick="openNewFollowup()">
                    <i class="bi bi-plus-lg me-2"></i>New Follow-Up
                </button>
            </div>

            <div class="card border-0 bg-transparent shadow-none">
                <div class="card mb-5 border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-end-0 ps-3"><i
                                            class="bi bi-search text-muted"></i></span>
                                    <input type="text" id="followupSearchInput"
                                        class="form-control border-start-0 bg-white shadow-none"
                                        placeholder="Search student...">
                                </div>
                            </div>
                            <div class="col-md-7 text-end">
                                <!-- Hidden inputs for JS compat -->
                                <input type="hidden" id="followupDateFromFilter">
                                <input type="hidden" id="followupDateToFilter">
                                <input type="hidden" id="followupDateFilter">
                                <input type="hidden" id="followupStatusFilter">
                                <input type="hidden" id="followupSchoolFilter">
                                <button class="btn btn-white border shadow-sm" onclick="applyFollowupFilters()"><i
                                        class="bi bi-arrow-clockwise me-2"></i> Refresh</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-custom" id="followupsTable">
                        <thead>
                            <tr>
                                <th class="ps-4">ID</th>
                                <th>Student Name</th>
                                <th>School</th>
                                <th>Last Visit</th>
                                <th>Status</th>
                                <th class="text-end pe-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- JS Populated -->
                        </tbody>
                    </table>
                </div>

                <div class="d-flex justify-content-between align-items-center mt-4">
                    <small class="text-muted fw-medium" id="followupPaginationInfo"></small>
                    <div class="btn-group shadow-sm">
                        <button class="btn btn-white border px-3" id="followupPrevBtn"
                            onclick="prevFollowupPage()">Prev</button>
                        <button class="btn btn-white border px-3" id="followupNextBtn"
                            onclick="nextFollowupPage()">Next</button>
                    </div>
                </div>
            </div>
        </section>

    </div> <!-- End Content -->
    </div> <!-- End Wrapper -->


    <!-- ===================== MODALS & OVERLAYS ===================== -->

    <!-- Review Overlay (Custom) -->
    <div id="popupInline" class="review-overlay">
        <div class="review-box">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="fw-bold mb-0">Review Responses</h5>
                <button type="button" class="btn-close" onclick="closeReview()"></button>
            </div>
            <div id="reviewContent" class="mb-4"></div>
            <div class="d-flex justify-content-end gap-2">
                <button class="btn btn-outline-secondary" onclick="editForm()">Edit</button>
                <button class="btn btn-success" onclick="finalSubmit()">Confirm Submission</button>
            </div>
        </div>
    </div>

    <!-- FollowUp Modal (Bootstrap) -->
    <div class="modal fade" id="followupModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-white border-bottom-0 pb-0">
                    <div>
                        <h5 class="modal-title fw-bold text-dark" id="followupModalTitle">New Follow-Up</h5>
                        <p class="text-muted small m-0">Enter the latest clinical findings for the patient.</p>
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body bg-light">
                    <form id="followupForm">
                        <div class="card mb-4 border-0 shadow-sm">
                            <div class="card-body">
                                <h6 class="fw-bold text-muted mb-3 text-uppercase small">Visit Details</h6>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label">Student ID</label>
                                        <input type="text" class="form-control" name="fuStudentId" id="fuStudentId"
                                            required>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Visit Date</label>
                                        <input type="date" class="form-control" name="fuVisitDate" id="fuLastVisit"
                                            required>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Next Visit</label>
                                        <input type="date" class="form-control" name="fuNextVisit" id="fuNextVisit"
                                            required>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h6 class="fw-bold text-muted mb-3 text-uppercase small">Clinical Data</h6>
                                <div class="row g-4">
                                    <!-- Uncorrected VA -->
                                    <div class="col-md-6">
                                        <label class="form-label">Uncorrected Visual Acuity</label>
                                        <div class="input-group">
                                            <input type="text" name="ucva_re" class="form-control" placeholder="Right Eye (OD)">
                                            <input type="text" name="ucva_le" class="form-control" placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Best Corrected VA -->
                                    <div class="col-md-6">
                                        <label class="form-label">Best Corrected Visual Acuity</label>
                                        <div class="input-group">
                                            <input type="text" name="bcva_re" class="form-control" placeholder="Right Eye (OD)">
                                            <input type="text" name="bcva_le" class="form-control" placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Cycloplegic SE -->
                                    <div class="col-md-6">
                                        <label class="form-label">Cycloplegic Refraction (SE)</label>
                                        <div class="input-group">
                                            <input type="text" name="cyclo_se_re" class="form-control" placeholder="Right Eye (OD)">
                                            <input type="text" name="cyclo_se_le" class="form-control" placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Axial Length -->
                                    <div class="col-md-6">
                                        <label class="form-label">Axial Length (mm)</label>
                                        <div class="input-group">
                                            <input type="text" name="axial_length_re" class="form-control" placeholder="Right Eye (OD)">
                                            <input type="text" name="axial_length_le" class="form-control" placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Keratometry -->
                                    <div class="col-md-6">
                                        <label class="form-label">Keratometry (K1/K2)</label>
                                        <div class="input-group">
                                            <input type="text" name="keratometry_re" class="form-control" placeholder="Right Eye (OD)">
                                            <input type="text" name="keratometry_le" class="form-control" placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Central Corneal Thickness -->
                                    <div class="col-md-6">
                                        <label class="form-label">Central Corneal Thickness (μm)</label>
                                        <div class="input-group">
                                            <input type="text" name="cct_re" class="form-control" placeholder="Right Eye (OD)">
                                            <input type="text" name="cct_le" class="form-control" placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Anterior Segment -->
                                    <div class="col-md-6">
                                        <label class="form-label">Anterior Segment Findings</label>
                                        <textarea name="anterior_segment_re" class="form-control" rows="2" placeholder="Right Eye (OD)"></textarea>
                                        <textarea name="anterior_segment_le" class="form-control mt-2" rows="2" placeholder="Left Eye (OS)"></textarea>
                                    </div>
                                    <!-- Fundus Findings -->
                                    <div class="col-md-6">
                                        <label class="form-label">Fundus Findings</label>
                                        <textarea name="fundus_findings_re" class="form-control" rows="2" placeholder="Right Eye (OD)"></textarea>
                                        <textarea name="fundus_findings_le" class="form-control mt-2" rows="2" placeholder="Left Eye (OS)"></textarea>
                                    </div>
                                    <!-- Amblyopia or Strabismus -->
                                    <div class="col-12">
                                        <label class="form-label d-block">Amblyopia or Strabismus Present</label>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="amblyopia_or_strabismus" id="amblyopiaYes" value="true">
                                            <label class="form-check-label" for="amblyopiaYes">Yes</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="amblyopia_or_strabismus" id="amblyopiaNo" value="false" checked>
                                            <label class="form-check-label" for="amblyopiaNo">No</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-none">
                                     <input name="spherical_re"><input name="spherical_le">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer bg-white border-top-0">
                    <button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-info text-white" onclick="reviewFollowup()">Review</button>
                    <button class="btn btn-primary" id="followupSubmitBtn">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Followup Review Overlay -->
    <div id="followupReviewOverlay" class="review-overlay">
        <div class="review-box">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="fw-bold mb-0">Review Follow-Up</h5>
                <button type="button" class="btn-close" onclick="closeFollowupReview()"></button>
            </div>
            <div id="followupReviewContent" class="small mb-3"></div>
            <div class="d-flex justify-content-end gap-2">
                <button class="btn btn-outline-secondary btn-sm" onclick="editFollowup()">Edit</button>
                <button class="btn btn-success btn-sm" id="followupFinalSubmitBtn" onclick="submitFollowup()">Confirm</button>
            </div>
        </div>
    </div>

    <form id="logoutForm" method="POST" action="login.html" class="d-none"></form>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script src="static/js/user_dash.js"></script>
</body>

</html>
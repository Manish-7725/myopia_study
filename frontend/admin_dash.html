<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Dashboard â€¢ Myopia Study</title>

    <!-- Fonts: Inter for a clean, modern look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

    <!-- Bootstrap 5 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />


    <link rel="stylesheet" href="static/css/admin_dash.css" />
</head>

<body>
    <!-- Toast Container for Notifications -->
    <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1080;"></div>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay"></div>

    <!-- SIDEBAR -->
    <aside id="sidebar" style="overflow-y: auto; max-height: 100vh;">

        <button class="btn-close-sidebar"><i class="fa-solid fa-xmark"></i></button>
        <div class="sidebar-brand">
            <div class="bg-primary bg-gradient rounded-4 p-2 d-flex align-items-center justify-content-center text-white shadow-sm"
                style="width: 44px; height: 44px;">
                <i class="fa-solid fa-eye fs-5"></i>
            </div>
            <span class="fs-5">Myopia Study</span>
        </div>

        <nav class="flex-column mt-4 px-3">
            <div class="small fw-bold text-uppercase text-muted mb-3 px-3"
                style="font-size: 0.75rem; letter-spacing: 0.08em;">Admin Menu</div>

            <!-- Dashboard -->
            <div class="nav-link active" id="nav-dashboard-link">
                <i class="bi bi-grid-1x2-fill"></i>
                <span>Dashboard</span>
            </div>

            <!-- Students -->
            <div class="nav-link" id="nav-patients-link">
                <i class="bi bi-people-fill"></i>
                <span>Students</span>
            </div>

            <!-- Users & Admin -->
            <div class="nav-link" id="nav-users-link">
                <i class="bi bi-person-gear"></i>
                <span>Users & Admin</span>
            </div>

            <!-- Forms & Data -->
            <div class="nav-link" id="nav-forms-link">
                <i class="bi bi-clipboard-data-fill"></i>
                <span>Forms & Data</span>
            </div>

            <!-- Follow-Ups -->
            <div class="nav-link" id="nav-followups-link">
                <i class="bi bi-calendar-check-fill"></i>
                <span>Follow-Ups</span>
            </div>

            <!-- Analytics -->
            <div class="nav-link" id="nav-analytics-link">
                <i class="bi bi-graph-up"></i>
                <span>Analytics</span>
            </div>

            <!-- Reports / Export -->
            <div class="nav-link" id="nav-reports-link">
                <i class="bi bi-file-earmark-spreadsheet-fill"></i>
                <span>Reports / Export</span>
            </div>

            <!-- Audit Logs -->
            <div class="nav-link" id="nav-audit-link">
                <i class="bi bi-journal-text"></i>
                <span>Audit Logs</span>
            </div>

            <!-- System Settings -->
            <div class="nav-link" id="nav-system-settings-link">
                <i class="bi bi-gear-fill"></i>
                <span>System Settings</span>
            </div>


        </nav>

        <div class="mt-auto border-top border-light p-4">
            <div class="d-flex align-items-center gap-3 mb-4">
                <img src="https://ui-avatars.com/api/?name=Dr+Clinician&background=0ea5e9&color=fff&size=128"
                    class="rounded-circle shadow-sm" width="40" height="40">
                <div style="line-height: 1.2;">
                    <div class="fw-bold text-dark fs-6">Dr. Clinician</div>
                    <small class="text-muted fw-medium" style="font-size: 0.8rem;">Ophthalmologist</small>
                </div>
            </div>
            <button class="btn btn-light w-100 text-danger fw-bold justify-content-center" id="logout-button">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </aside>


    <!-- MAIN WRAPPER -->
    <div id="content-wrapper">

        <!-- TOP NAVBAR -->
        <nav class="main-navbar">
            <div class="d-flex align-items-center">
                <!-- Mobile Toggle -->
                <button class="btn btn-light d-lg-none me-3" id="mobileSidebarToggle">
                    <i class="fa fa-bars"></i>
                </button>
                <!-- Desktop Toggle -->
                <button class="btn btn-light d-none d-lg-block me-3" id="desktopSidebarToggle">
                    <i class="fa-solid fa-bars-staggered"></i>
                </button>
                <h5 class="mb-0 fw-bold d-none d-sm-block text-secondary fs-6"> <i
                        class="bi bi-house-door me-2"></i>Myopia Study Portal
                </h5>
            </div>

            <div class="d-flex align-items-center gap-4">
                <!-- Global Search -->
                <div class="d-none d-md-block">
                    <div class="input-group" style="width: 250px;">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="bi bi-search text-muted"></i>
                        </span>
                        <input type="text" class="form-control border-start-0 ps-1" placeholder="Search everything..." id="globalSearch">
                    </div>
                </div>

                <!-- Notifications -->
                <div class="dropdown">
                    <button class="btn btn-light rounded-circle p-0 position-relative" style="width: 38px; height: 38px;" data-bs-toggle="dropdown">
                        <i class="bi bi-bell"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.6rem;">3</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg mt-2" style="width: 320px;">
                        <li><h6 class="dropdown-header">Notifications</h6></li>
                        <li>
                            <a class="dropdown-item py-3" href="#">
                                <div class="d-flex">
                                    <div class="flex-shrink-0 me-3">
                                        <div class="bg-warning bg-opacity-10 rounded-circle p-2">
                                            <i class="bi bi-exclamation-triangle text-warning"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <p class="mb-1 small fw-bold">System Maintenance</p>
                                        <p class="mb-0 small text-muted">Scheduled for tonight 2:00 AM</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item py-3" href="#">
                                <div class="d-flex">
                                    <div class="flex-shrink-0 me-3">
                                        <div class="bg-info bg-opacity-10 rounded-circle p-2">
                                            <i class="bi bi-person-plus text-info"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <p class="mb-1 small fw-bold">New User Registered</p>
                                        <p class="mb-0 small text-muted">Dr. Emily Chen joined the system</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item py-3" href="#">
                                <div class="d-flex">
                                    <div class="flex-shrink-0 me-3">
                                        <div class="bg-success bg-opacity-10 rounded-circle p-2">
                                            <i class="bi bi-check-circle text-success"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <p class="mb-1 small fw-bold">Backup Completed</p>
                                        <p class="mb-0 small text-muted">Daily backup finished successfully</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-center small text-muted" href="#">View All Notifications</a></li>
                    </ul>
                </div>

                <!-- Profile Dropdown -->
                <div class="dropdown">
                    <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle text-dark"
                        id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="d-flex flex-column align-items-end me-3 d-none d-md-block">
                            <span class="small fw-bold text-dark">Dr. Sarah Johnson</span>
                            <span class="badge bg-danger bg-opacity-10 text-danger small">Administrator</span>
                        </div>
                        <img src="https://ui-avatars.com/api/?name=Dr+Sarah+Johnson&background=0ea5e9&color=fff&size=128"
                            class="rounded-circle" width="38" height="38">
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg mt-2 p-2 rounded-4"
                        aria-labelledby="profileDropdown">
                        <li>
                            <h6 class="dropdown-header">Dr. Sarah Johnson</h6>
                            <small class="text-muted">Administrator</small>
                        </li>
                        <li><a class="dropdown-item rounded-2 py-2" href="#" onclick="openEditProfile()"><i
                                    class="bi bi-person me-2"></i>My Profile</a></li>
                        <li><a class="dropdown-item rounded-2 py-2" href="#"><i
                                    class="bi bi-gear me-2"></i>Preferences</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item rounded-2 py-2 text-danger" href="#" id="logout-link"><i
                                    class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </nav>


        <!-- CONTENT AREA -->
        <div id="content">

            <!-- ===================== DASHBOARD ===================== -->
            <section id="dashboard" class="spa-section active">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-5">
                    <div class="mb-4 mb-md-0">
                        <h2 class="section-title">Dashboard Overview</h2>
                        <p class="text-muted m-0 fs-6">Welcome back! Here's your study progress for today.</p>
                    </div>

                </div>

                <!-- Summary Cards -->
                <div class="row g-4 mb-5">
                    <!-- Total Users -->
                    <div class="col-md-6 col-lg-3 metric-card-wrapper">
                        <div class="card h-100 border-0">
                            <div class="card-body metric-card">
                                <div class="metric-icon bg-soft-blue">
                                    <i class="bi bi-person-fill"></i>
                                </div>
                                <div>
                                    <h3 class="fw-bold mb-1 text-dark" id="totalUsers">--</h3>
                                    <span class="text-muted fw-medium small">Total Users</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Total Students -->
                    <div class="col-md-6 col-lg-3 metric-card-wrapper">
                        <div class="card h-100 border-0">
                            <div class="card-body metric-card">
                                <div class="metric-icon bg-soft-green">
                                    <i class="bi bi-people-fill"></i>
                                </div>
                                <div>
                                    <h3 class="fw-bold mb-1 text-dark" id="totalStudents">--</h3>
                                    <span class="text-muted fw-medium small">Total Students</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Active Clinicians Today -->
                    <div class="col-md-6 col-lg-3 metric-card-wrapper">
                        <div class="card h-100 border-0">
                            <div class="card-body metric-card">
                                <div class="metric-icon bg-soft-purple">
                                    <i class="bi bi-activity"></i>
                                </div>
                                <div>
                                    <h3 class="fw-bold mb-1 text-dark" id="activeClinicians">--</h3>
                                    <span class="text-muted fw-medium small">Active Users Today</span>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- Forms Submitted Today -->
                    <div class="col-md-6 col-lg-3 metric-card-wrapper">
                        <div class="card h-100 border-0">
                            <div class="card-body metric-card">
                                <div class="metric-icon bg-soft-orange">
                                    <i class="bi bi-file-earmark-check-fill"></i>
                                </div>
                                <div>
                                    <h3 class="fw-bold mb-1 text-dark" id="formsSubmittedToday">--</h3>
                                    <span class="text-muted fw-medium small">Forms Submitted Today</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity Table -->
                <div class="row g-4 mb-5">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white border-bottom-0 py-4">
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle bg-info bg-opacity-10 p-2 me-3">
                                        <i class="bi bi-clock-history text-info fs-5"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-1 fw-bold text-dark">Recent Activity</h5>
                                        <p class="text-muted small mb-0">Latest system activities and user actions</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-custom mb-0" id="recentActivityTable">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="ps-4" style="width: 60px;">Type</th>
                                                <th style="width: 150px;">Timestamp</th>
                                                <th>User</th>
                                                <th>Action</th>
                                                <th>Details</th>
                                                <th style="width: 100px;" class="text-end pe-4">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentActivityBody">
                                            <!-- Recent activities will be populated here by JS -->
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-success bg-opacity-75">
                                                        <i class="bi bi-person-plus-fill"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">2 hours ago</td>
                                                <td class="fw-medium">Dr. Sarah Johnson</td>
                                                <td class="fw-medium">User Created</td>
                                                <td class="small text-muted">Account for Dr. Emily Chen activated</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-primary bg-opacity-75">
                                                        <i class="bi bi-file-earmark-check-fill"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">3 days ago</td>
                                                <td class="fw-medium">Dr. Patricia Taylor</td>
                                                <td class="fw-medium">Form Submitted</td>
                                                <td class="small text-muted">Clinical data for Student ID: STU-2024-112</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-warning bg-opacity-75">
                                                        <i class="bi bi-pencil-square"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">3 days ago</td>
                                                <td class="fw-medium">Dr. Christopher Martinez</td>
                                                <td class="fw-medium">Record Updated</td>
                                                <td class="small text-muted">Corrected demographic info for Liam Johnson</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-info bg-opacity-75">
                                                        <i class="bi bi-search"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">4 days ago</td>
                                                <td class="fw-medium">Dr. Amanda White</td>
                                                <td class="fw-medium">Search Performed</td>
                                                <td class="small text-muted">Advanced search by multiple criteria</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-info">Info</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-success bg-opacity-75">
                                                        <i class="bi bi-person-plus-fill"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">4 days ago</td>
                                                <td class="fw-medium">Dr. Kevin Rodriguez</td>
                                                <td class="fw-medium">User Created</td>
                                                <td class="small text-muted">Account for Dr. Rachel Green activated</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-primary bg-opacity-75">
                                                        <i class="bi bi-file-earmark-check-fill"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">5 days ago</td>
                                                <td class="fw-medium">Dr. Michelle Thompson</td>
                                                <td class="fw-medium">Form Submitted</td>
                                                <td class="small text-muted">Clinical data for Student ID: STU-2024-156</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-warning bg-opacity-75">
                                                        <i class="bi bi-pencil-square"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">5 days ago</td>
                                                <td class="fw-medium">Dr. Daniel Harris</td>
                                                <td class="fw-medium">Record Updated</td>
                                                <td class="small text-muted">Updated ocular measurements for Sophia Davis</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-info bg-opacity-75">
                                                        <i class="bi bi-search"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">6 days ago</td>
                                                <td class="fw-medium">Dr. Jessica Clark</td>
                                                <td class="fw-medium">Search Performed</td>
                                                <td class="small text-muted">Filtered students by school and age</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-info">Info</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-success bg-opacity-75">
                                                        <i class="bi bi-calendar-plus-fill"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">6 days ago</td>
                                                <td class="fw-medium">Dr. Brian Lewis</td>
                                                <td class="fw-medium">Follow-up Scheduled</td>
                                                <td class="small text-muted">Scheduled 6-month checkup for Oliver Taylor</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-primary bg-opacity-75">
                                                        <i class="bi bi-file-earmark-check-fill"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">1 week ago</td>
                                                <td class="fw-medium">Dr. Samantha Walker</td>
                                                <td class="fw-medium">Form Submitted</td>
                                                <td class="small text-muted">Clinical data for Student ID: STU-2024-203</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-warning bg-opacity-75">
                                                        <i class="bi bi-pencil-square"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">1 week ago</td>
                                                <td class="fw-medium">Dr. Matthew Hall</td>
                                                <td class="fw-medium">Record Updated</td>
                                                <td class="small text-muted">Modified lifestyle questionnaire for Ava Martinez</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-info bg-opacity-75">
                                                        <i class="bi bi-search"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">1 week ago</td>
                                                <td class="fw-medium">Dr. Ashley Young</td>
                                                <td class="fw-medium">Search Performed</td>
                                                <td class="small text-muted">Bulk export preparation query</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-info">Info</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-success bg-opacity-75">
                                                        <i class="bi bi-person-plus-fill"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">8 days ago</td>
                                                <td class="fw-medium">Dr. Ryan King</td>
                                                <td class="fw-medium">User Created</td>
                                                <td class="small text-muted">Account for Dr. Natalie Scott activated</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-primary bg-opacity-75">
                                                        <i class="bi bi-file-earmark-check-fill"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">8 days ago</td>
                                                <td class="fw-medium">Dr. Lauren Adams</td>
                                                <td class="fw-medium">Form Submitted</td>
                                                <td class="small text-muted">Clinical data for Student ID: STU-2024-267</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-warning bg-opacity-75">
                                                        <i class="bi bi-pencil-square"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">9 days ago</td>
                                                <td class="fw-medium">Dr. Tyler Baker</td>
                                                <td class="fw-medium">Record Updated</td>
                                                <td class="small text-muted">Updated environmental factors for Noah Garcia</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-info bg-opacity-75">
                                                        <i class="bi bi-search"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">9 days ago</td>
                                                <td class="fw-medium">Dr. Hannah Nelson</td>
                                                <td class="fw-medium">Search Performed</td>
                                                <td class="small text-muted">Follow-up status overview query</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-info">Info</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="ps-4">
                                                    <div class="badge bg-success bg-opacity-75">
                                                        <i class="bi bi-calendar-plus-fill"></i>
                                                    </div>
                                                </td>
                                                <td class="small text-muted">10 days ago</td>
                                                <td class="fw-medium">Dr. Ethan Carter</td>
                                                <td class="fw-medium">Follow-up Scheduled</td>
                                                <td class="small text-muted">Annual review scheduled for Isabella Rodriguez</td>
                                                <td class="text-end pe-4">
                                                    <span class="badge bg-success">Success</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer bg-white border-top-0 py-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted fw-medium">Showing recent 5 activities</small>
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewAllActivities()">
                                        <i class="bi bi-eye me-1"></i>View All Activities
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



            </section>

            <!-- ===================== STUDENTS ===================== -->
            <section id="patients" class="spa-section">
                <div class="d-flex align-items-center justify-content-between mb-5">
                    <div>
                        <h2 class="section-title mb-2">Student Management</h2>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#"
                                        onclick="showSection('dashboard', document.getElementById('dashboard-nav'))">Dashboard</a>
                                </li>
                                <li class="breadcrumb-item active">Students</li>
                            </ol>
                        </nav>
                    </div>
                    <div class="d-flex gap-3">


                    </div>
                </div>



                <!-- Filters and Search -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body p-4 d-flex justify-content-between">
                        <div class="input-group" style="width: 300px;">
                            <span class="input-group-text bg-white border-end-0 ps-3"><i class="bi bi-search text-muted"></i></span>
                            <input type="text" id="patientSearchInput" class="form-control border-start-0 ps-1 bg-white shadow-none" placeholder="Search by ID, name, or school...">
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-funnel me-1"></i> Filters
                            </button>
                            <div class="dropdown-menu dropdown-menu-end p-4" aria-labelledby="filterDropdown" style="width: 500px;">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <select id="schoolFilter" class="form-select">
                                            <option value="">All Schools</option>
                                            <!-- Populated by JS -->
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <select id="genderFilter" class="form-select">
                                            <option value="">All Genders</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="col-md-12">
                                        <select id="statusFilter" class="form-select">
                                            <option value="">All Status</option>
                                            <option value="active">Active</option>
                                            <option value="locked">Locked</option>
                                            <option value="flagged">Flagged</option>
                                            <option value="inactive">Inactive</option>
                                        </select>
                                    </div>
                                    <div class="col-12 text-end mt-4">
                                        <button class="btn btn-outline-secondary me-2" onclick="clearPatientFilters()">
                                            <i class="bi bi-x-circle me-1"></i>Clear
                                        </button>
                                        <button class="btn btn-primary" onclick="applyPatientFilters()">
                                            <i class="bi bi-funnel me-1"></i>Apply Filters
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Global Student Table -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom-0 py-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 fw-bold text-dark">Global Student Table</h5>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-outline-info" onclick="showFlaggedStudents()">
                                    <i class="bi bi-flag me-1"></i>Flagged
                                </button>
                                <button class="btn btn-sm btn-outline-warning" onclick="showLockedStudents()">
                                    <i class="bi bi-lock me-1"></i>Locked
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-custom mb-0" id="patientsTable">
                                <thead>
                                    <tr>
                                        <th class="ps-4">
                                            <input type="checkbox" id="selectAllStudentsCheckbox">
                                        </th>
                                        <th class="ps-4">Student ID</th>
                                        <th>Name</th>
                                        <th>School</th>
                                        <th>Age/Gender</th>
                                        <th>Created At</th>
                                        <th>Status</th>
                                        <th>Last Visit</th>
                                        <th class="text-end pe-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="studentsTableBody">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer bg-white border-top-0 py-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center gap-3">
                                <small class="text-muted fw-medium" id="patientPaginationInfo">Showing 0 entries</small>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        Bulk Actions
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" onclick="bulkLockStudents()">Lock Selected</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="bulkFlagStudents()">Flag Selected</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="bulkExportStudents()">Export Selected</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="btn-group shadow-sm">
                                <button class="btn btn-white border px-3" id="patientPrevBtn" onclick="prevPatientPage()"><i
                                        class="bi bi-chevron-left"></i></button>
                                <button class="btn btn-white border px-3" id="patientNextBtn" onclick="nextPatientPage()"><i
                                        class="bi bi-chevron-right"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ===================== FORMS & DATA CONTROL ===================== -->
            <section id="forms" class="spa-section">
                <div class="d-flex justify-content-between align-items-center mb-5">
                    <div>
                        <h2 class="section-title mb-2">Forms & Data Control</h2>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#" onclick="showSection('dashboard', document.getElementById('dashboard-nav'))">Dashboard</a></li>
                                <li class="breadcrumb-item active">Forms & Data</li>
                            </ol>
                        </nav>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary" onclick="exportFormsData()">
                            <i class="bi bi-download me-2"></i>Export Data
                        </button>
                        <button class="btn btn-primary" onclick="switchFormState('entry')">
                            <i class="bi bi-plus-lg me-2"></i>New Entry
                        </button>
                    </div>
                </div>

                <!-- Forms & Data Control Overview -->
                <div class="alert alert-info border-0 bg-soft-blue mb-4">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-file-earmark-bar-graph text-primary fs-4 me-3"></i>
                        <div>
                            <h6 class="mb-1 text-primary fw-bold">Comprehensive Form & Data Management</h6>
                            <p class="mb-0 small">Access and review all submitted clinical forms. Utilize powerful filtering options by user, date, and submission status, and open any form in a read-only mode for detailed review.</p>
                        </div>
                    </div>
                </div>

                <!-- Data Safety Alert -->
                <div class="alert alert-info border-0 bg-soft-blue mb-4">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-shield-check text-primary fs-4 me-3"></i>
                        <div>
                            <h6 class="mb-1 text-primary fw-bold">Data Safety & Integrity</h6>
                            <p class="mb-0 small">Review, validate, and secure all clinical data submissions. Lock forms to prevent unauthorized changes and flag invalid data for review.</p>
                        </div>
                    </div>
                </div>

                <!-- Filters and Controls -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label class="form-label small fw-bold">Search</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-muted"></i></span>
                                    <input type="text" id="formsSearchInput" class="form-control border-start-0" placeholder="Search by ID, student, or school...">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small fw-bold">Status</label>
                                <select class="form-select" id="formsStatusFilter">
                                    <option value="">All Status</option>
                                    <option value="draft">Draft</option>
                                    <option value="submitted">Submitted</option>
                                    <option value="locked">Locked</option>
                                    <option value="flagged">Flagged</option>
                                    <option value="invalid">Invalid</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small fw-bold">Submitted By</label>
                                <select class="form-select" id="formsUserFilter">
                                    <option value="">All Users</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small fw-bold">From Date</label>
                                <input type="date" class="form-control" id="formsDateFrom">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small fw-bold">To Date</label>
                                <input type="date" class="form-control" id="formsDateTo">
                            </div>
                            <div class="col-md-1 d-flex align-items-end">
                                <button class="btn btn-outline-secondary w-100" onclick="clearFormsFilters()">
                                    <i class="bi bi-x-circle"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bulk Actions -->
                <div class="card border-0 shadow-sm mb-4" id="bulkActionsCard" style="display: none;">
                    <div class="card-body p-3 bg-light">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-3">
                                <span class="fw-bold text-dark" id="selectedCount">0 forms selected</span>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-danger" onclick="bulkLockForms()">
                                        <i class="bi bi-lock me-1"></i>Lock Selected
                                    </button>
                                    <button class="btn btn-outline-warning" onclick="bulkFlagForms()">
                                        <i class="bi bi-flag me-1"></i>Flag Invalid
                                    </button>
                                    <button class="btn btn-outline-success" onclick="bulkValidateForms()">
                                        <i class="bi bi-check-circle me-1"></i>Mark Valid
                                    </button>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline-secondary" onclick="clearFormSelection()">
                                <i class="bi bi-x"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Forms Table -->
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-custom mb-0" id="formsDataTable">
                                <thead class="table-light">
                                    <tr>
                                        <th class="ps-4" style="width: 40px;">
                                            <input type="checkbox" class="form-check-input" id="selectAllForms" onchange="toggleAllForms()">
                                        </th>
                                        <th style="width: 80px;">ID</th>
                                        <th style="width: 120px;">Date Submitted</th>
                                        <th>Student Name</th>
                                        <th>School</th>
                                        <th style="width: 100px;">Status</th>
                                        <th style="width: 120px;">Submitted By</th>
                                        <th style="width: 150px;" class="text-end pe-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="formsDataBody">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Empty State -->
                        <div id="formsEmptyState" class="text-center py-5" style="display: none;">
                            <div class="mb-3">
                                <i class="bi bi-clipboard-x text-muted" style="font-size: 3rem;"></i>
                            </div>
                            <h5 class="text-muted">No forms found</h5>
                            <p class="text-muted small">Try adjusting your filters or create a new entry.</p>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div class="card-footer bg-white border-top-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted fw-medium" id="formsPaginationInfo">Showing 0 forms</small>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-secondary" id="formsPrevBtn" onclick="prevFormsPage()" disabled>
                                    <i class="bi bi-chevron-left"></i> Previous
                                </button>
                                <button class="btn btn-outline-secondary" id="formsNextBtn" onclick="nextFormsPage()" disabled>
                                    Next <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Entry Form State -->
                <div id="formsEntryState" style="display: none;">
                    <div class="d-flex align-items-center mb-5">
                        <button class="btn btn-white border shadow-sm me-4 px-3" onclick="switchFormState('list')">
                            <i class="fa fa-arrow-left"></i>
                        </button>
                        <div>
                            <h3 class="fw-bold mb-1 text-dark" id="formEntryTitle">New Clinical Entry</h3>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#"
                                            onclick="showSection('dashboard', document.querySelector('div[onclick*=dashboard]'))">Dashboard</a>
                                    </li>
                                    <li class="breadcrumb-item"><a href="#"
                                            onclick="switchFormState('list')">Entries</a></li>
                                    <li class="breadcrumb-item active">New Form</li>
                                </ol>
                            </nav>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-5">
                            <div class="text-center mb-5">
                                <div class="d-inline-flex align-items-center justify-content-center bg-soft-blue text-primary rounded-circle mb-4"
                                    style="width: 72px; height: 72px; font-size: 1.8rem;">
                                    <i class="bi bi-clipboard2-pulse-fill"></i>
                                </div>
                                <h4 class="fw-bold text-dark fs-3">Myopia Progression Study Questionnaire</h4>
                                <p class="text-muted fs-6">School-Going Children (Age 6â€“18 Years)</p>
                            </div>

                            <form id="myopiaForm" class="needs-validation" novalidate>
                                <div class="accordion" id="myopiaFormAccordion">

                                    <!-- Section A -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingA">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                                data-bs-target="#collapseA">
                                                <div class="d-flex align-items-center">
                                                    <div class="rounded-circle bg-soft-blue text-primary d-flex align-items-center justify-content-center me-3"
                                                        style="width: 36px; height: 36px;">
                                                        <i class="bi bi-person-fill"></i>
                                                    </div>
                                                    <span>Section A: Demographic Information</span>
                                                </div>
                                            </button>
                                        </h2>
                                        <div id="collapseA" class="accordion-collapse collapse show"
                                            data-bs-parent="#myopiaFormAccordion">
                                            <div class="accordion-body bg-white p-4">
                                                <div class="row g-4">
                                                    <div class="col-md-6">
                                                        <label class="form-label">Name of Student</label>
                                                        <input type="text" class="form-control" name="name" required>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">School Name</label>
                                                        <input type="text" class="form-control" name="school_name">
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Age (years)</label>
                                                        <input type="number" class="form-control" name="age" min="1"
                                                            required>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Gender</label>
                                                        <select class="form-select" name="gender" required>
                                                            <option value="">Select</option>
                                                            <option value="Male">Male</option>
                                                            <option value="Female">Female</option>
                                                            <option value="Other">Other</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Height (cm)</label>
                                                        <input type="number" class="form-control" name="height"
                                                            step="0.1">
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Weight (kg)</label>
                                                        <input type="number" class="form-control" name="weight"
                                                            step="0.1">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">Parental Myopia</label>
                                                        <div class="d-flex gap-4 pt-2">
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio"
                                                                    name="parental_myopia" value="None"> <label
                                                                    class="form-check-label">None</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio"
                                                                    name="parental_myopia" value="Father"> <label
                                                                    class="form-check-label">Father</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio"
                                                                    name="parental_myopia" value="Mother"> <label
                                                                    class="form-check-label">Mother</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio"
                                                                    name="parental_myopia" value="Both"> <label
                                                                    class="form-check-label">Both</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Siblings (Count)</label>
                                                        <input type="number" class="form-control" name="num_siblings"
                                                            min="0">
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Birth Order</label>
                                                        <select class="form-select" name="birth_order">
                                                            <option value="">Select</option>
                                                            <option value="First">First</option>
                                                            <option value="Second">Second</option>
                                                            <option value="Third">Third</option>
                                                            <option value="Only">Only Child</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Siblings with Myopia</label>
                                                        <input type="number" class="form-control" name="siblings_myopia"
                                                            min="0">
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                                                    <button type="button" class="btn btn-light px-4"
                                                        onclick="resetSection('A')">Reset</button>
                                                    <button type="button" class="btn btn-primary px-5"
                                                        onclick="saveSection('A')">Save Progress</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section B -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingB">
                                            <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#collapseB">
                                                <div class="d-flex align-items-center">
                                                    <div class="rounded-circle bg-soft-orange text-orange d-flex align-items-center justify-content-center me-3"
                                                        style="width: 36px; height: 36px; color: var(--accent-color); background: var(--accent-light);">
                                                        <i class="bi bi-activity"></i>
                                                    </div>
                                                    <span>Section B: Behavioral & Lifestyle</span>
                                                </div>
                                            </button>
                                        </h2>
                                        <div id="collapseB" class="accordion-collapse collapse"
                                            data-bs-parent="#myopiaFormAccordion">
                                            <div class="accordion-body bg-white p-4">
                                                <div class="row g-4">
                                                    <div class="col-md-6"><label class="form-label">10. Time of Daily
                                                            Outdoor Activity</label><input type="time"
                                                            class="form-control" name="outdoor_time"></div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">11. Duration of Outdoor
                                                            Activity</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="outdoor_duration" value="<1 hr"
                                                                    class="form-check-input"> &lt;1 hr</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="outdoor_duration" value="1-2 hrs"
                                                                    class="form-check-input"> 1â€“2 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="outdoor_duration" value="2-4 hrs"
                                                                    class="form-check-input"> 2â€“4 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="outdoor_duration" value=">4 hrs"
                                                                    class="form-check-input"> &gt;4 hrs</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">12. Sun Exposure during
                                                            Outdoor Activity</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="sun_exposure" value="<1 hr"
                                                                    class="form-check-input"> Bright Sunlight</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sun_exposure" value="1-3 hrs"
                                                                    class="form-check-input"> Partial Sunlight</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sun_exposure" value="3-5 hrs"
                                                                    class="form-check-input"> Shade</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">13. Weekly Frequency of
                                                            Sports/Extracurricular Activities</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="sports_activity" value="<1 hr"
                                                                    class="form-check-input"> Everyday</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sports_activity" value="1-3 hrs"
                                                                    class="form-check-input"> Alternate day</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sports_activity" value="3-5 hrs"
                                                                    class="form-check-input"> Weekends</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sports_activity" value="3-5 hrs"
                                                                    class="form-check-input"> Occasionally</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">14. Near-Work
                                                            Activities</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_activity" value="<1 hr"
                                                                    class="form-check-input"> Reading</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_activity" value="1-3 hrs"
                                                                    class="form-check-input"> Writing</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_activity" value="3-5 hrs"
                                                                    class="form-check-input"> Both</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">15. Hours of
                                                            Near-Work</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_hours" value="<1 hr"
                                                                    class="form-check-input"> &lt;1 hr</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_hours" value="1-3 hrs"
                                                                    class="form-check-input"> 1-3 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="near_work_hours" value="3-5 hrs"
                                                                    class="form-check-input"> 3-5 hrs</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">16. Daily Screen
                                                            Time</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="screen_time" value="<1 hr"
                                                                    class="form-check-input"> &lt;1 hr</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="screen_time" value="1-3 hrs"
                                                                    class="form-check-input"> 1-3 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="screen_time" value="3-5 hrs"
                                                                    class="form-check-input"> 3-5 hrs</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">17. Primary Device
                                                            Usage</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="primary_device" value="<1 hr"
                                                                    class="form-check-input"> Television</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="primary_device" value="1-3 hrs"
                                                                    class="form-check-input"> Smartphone</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="primary_device" value="3-5 hrs"
                                                                    class="form-check-input"> Tablet</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="primary_device" value="3-5 hrs"
                                                                    class="form-check-input"> Computer</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">18. Reading Distance</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="reading_distance" value="<1 hr"
                                                                    class="form-check-input"> &lt;15 cm</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="reading_distance" value="1-3 hrs"
                                                                    class="form-check-input"> 15-30 cm</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="reading_distance" value="3-5 hrs"
                                                                    class="form-check-input"> &gt;30 cm</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">19. Ratio of Correct
                                                            Book-Holding Posture</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="book_holding_posture" value="<1 hr"
                                                                    class="form-check-input"> 1/4th</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="book_holding_posture" value="1-3 hrs"
                                                                    class="form-check-input"> 2/4th</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="book_holding_posture" value="3-5 hrs"
                                                                    class="form-check-input"> 3/4th</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="book_holding_posture" value="3-5 hrs"
                                                                    class="form-check-input"> 4/4th</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">20. Average Sleep
                                                            Duration</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="sleep_duration" value="<1 hr"
                                                                    class="form-check-input"> &lt;6 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sleep_duration" value="1-3 hrs"
                                                                    class="form-check-input"> 6-8 hrs</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="sleep_duration" value="3-5 hrs"
                                                                    class="form-check-input"> &gt;8 hrs</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">21. Usual Bedtime</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="usual_bedtime" value="<1 hr"
                                                                    class="form-check-input"> 8-10 PM</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="usual_bedtime" value="1-3 hrs"
                                                                    class="form-check-input"> 10-12 AM</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="usual_bedtime" value="3-5 hrs"
                                                                    class="form-check-input"> &gt;12 AM</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label d-block">22. Dietary Habits</label>
                                                        <div class="d-flex flex-wrap gap-3 pt-2">
                                                            <div class="form-check"><input type="radio"
                                                                    name="dietary_habits" value="<1 hr"
                                                                    class="form-check-input"> Veg</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="dietary_habits" value="1-3 hrs"
                                                                    class="form-check-input"> Non-Veg</div>
                                                            <div class="form-check"><input type="radio"
                                                                    name="dietary_habits" value="3-5 hrs"
                                                                    class="form-check-input"> Mixed</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 mt-4">
                                                        <div
                                                            class="alert alert-info border-0 bg-soft-blue small mb-0 p-3 rounded-3">
                                                            <i class="bi bi-info-circle-fill me-2"></i> Ensure all
                                                            lifestyle questions are asked during the interview.
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                                                    <button type="button" class="btn btn-light px-4"
                                                        onclick="resetSection('B')">Reset</button>
                                                    <button type="button" class="btn btn-primary px-5"
                                                        onclick="saveSection('B')">Save Progress</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section C -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingC">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapseC">
                                            <div class="d-flex align-items-center">
                                                <div class="rounded-circle text-green d-flex align-items-center justify-content-center me-3"
                                                    style="width: 36px; height: 36px; color: var(--accent-color); background: var(--accent-light);">
                                                    <i class="bi bi-tree"></i>
                                                </div>
                                                <span>Section C: Environmental Factors</span>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapseC" class="accordion-collapse collapse"
                                        data-bs-parent="#myopiaFormAccordion">
                                        <div class="accordion-body bg-white p-4">
                                            <!-- Hidden fields present for JS to find -->
                                            <div class="row g-4">
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">23. School Type</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio" name="school_type"
                                                                value="Urban" class="form-check-input"> Urban</div>
                                                        <div class="form-check"><input type="radio" name="school_type"
                                                                value="Rural" class="form-check-input"> Rural</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">24. Classroom
                                                        Seating</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_seating" value="Urban"
                                                                class="form-check-input"> Front</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_seating" value="Rural"
                                                                class="form-check-input"> Middle</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_seating" value="Rural"
                                                                class="form-check-input"> Back</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">25. Seating Position in
                                                        Classroom</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio"
                                                                name="seating_position" value="Urban"
                                                                class="form-check-input"> Window</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="seating_position" value="Rural"
                                                                class="form-check-input"> Aisle</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="seating_position" value="Rural"
                                                                class="form-check-input"> Center</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">26. Teaching
                                                        Methodology</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio"
                                                                name="teaching_methodology" value="Urban"
                                                                class="form-check-input"> Blackboard</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="teaching_methodology" value="Rural"
                                                                class="form-check-input"> Audiovisual</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">27. Type of lighting in
                                                        Classroom</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_lighting" value="Urban"
                                                                class="form-check-input"> Fluorescent</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_lighting" value="Rural"
                                                                class="form-check-input"> Incandescent</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_lighting" value="Rural"
                                                                class="form-check-input"> LED</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="classroom_lighting" value="Rural"
                                                                class="form-check-input"> Natural</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">28. Type of lighting at
                                                        Home</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio" name="home_lighting"
                                                                value="Urban" class="form-check-input"> Fluorescent
                                                        </div>
                                                        <div class="form-check"><input type="radio" name="home_lighting"
                                                                value="Rural" class="form-check-input"> Incandescent
                                                        </div>
                                                        <div class="form-check"><input type="radio" name="home_lighting"
                                                                value="Rural" class="form-check-input"> LED</div>
                                                        <div class="form-check"><input type="radio" name="home_lighting"
                                                                value="Rural" class="form-check-input"> Natural</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">29. Sunlight in
                                                        Classroom</label>
                                                    <div class="d-flex gap-4 pt-2">
                                                        <div class="form-check"><input type="radio"
                                                                name="sunlight_in_classroom" value="Urban"
                                                                class="form-check-input"> Direct</div>
                                                        <div class="form-check"><input type="radio"
                                                                name="sunlight_in_classroom" value="Rural"
                                                                class="form-check-input"> Indirect</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                                                <button type="button" class="btn btn-primary px-5"
                                                    onclick="saveSection('C')">Save Progress</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section D -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingD">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapseD">
                                            <div class="d-flex align-items-center">
                                                <div class="rounded-circle text-purple d-flex align-items-center justify-content-center me-3"
                                                    style="width: 36px; height: 36px; color: var(--accent-color); background: var(--accent-light);">
                                                    <i class="bi bi-clock-history"></i>
                                                </div>
                                                <span>Section D: Clinical History</span>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapseD" class="accordion-collapse collapse"
                                        data-bs-parent="#myopiaFormAccordion">
                                        <div class="accordion-body p-4">
                                            <div class="row g-4">
                                                <div class="col-md-6">
                                                    <label class="form-label">30. Age of Onset of Myopia</label>
                                                    <input type="number" class="form-control"
                                                        name="age_of_onset_of_myopia">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">31. Duration of Myopia</label>
                                                    <input type="text" class="form-control" name="duration_of_myopia">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">32. Duration of Spectacle
                                                        Usage</label>
                                                    <input type="text" class="form-control"
                                                        name="spectacle_usage_duration">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">33. Previous Spectacle Power</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="previous_spectacle_power_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="previous_spectacle_power_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">34. Frequency of Spectacle
                                                        Change</label>
                                                    <div class="d-flex flex-wrap gap-3 pt-2">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="spectacle_change_frequency" value="<6 months">
                                                            &lt;6 months
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="spectacle_change_frequency" value="6-12 months">
                                                            6-12 months
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="spectacle_change_frequency" value=">12 months">
                                                            &gt;12 months
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">35. Family History of Myopia
                                                        (Relation)</label>
                                                    <input type="text" class="form-control"
                                                        name="family_history_of_myopia_relation">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label d-block">36. Any other Ocular
                                                        Conditions</label>
                                                    <div class="d-flex flex-wrap gap-3 pt-2">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="any_other_ocular_conditions" value="Yes">
                                                            Yes
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="any_other_ocular_conditions" value="No">
                                                            No
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">If Yes, Specify</label>
                                                    <input type="text" class="form-control"
                                                        name="any_other_ocular_conditions_specify">
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                                                <button type="button" class="btn btn-primary px-5"
                                                    onclick="saveSection('D')">Save</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section E -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingE">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapseE">
                                            <div class="d-flex align-items-center">
                                                <div class="rounded-circle text-info d-flex align-items-center justify-content-center me-3"
                                                    style="width: 36px; height: 36px; color: var(--accent-color); background: var(--accent-light);">
                                                    <i class="bi bi-shield-check"></i>
                                                </div>
                                                <span>Section E: Awareness & Safety</span>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapseE" class="accordion-collapse collapse"
                                        data-bs-parent="#myopiaFormAccordion">
                                        <div class="accordion-body p-4">
                                            <div class="d-none">
                                                <input type="radio" name="access_to_vision_care" value="true">
                                                <input type="radio" name="aware_eye_strain" value="true">
                                                <input type="radio" name="follows_preventive_measures" value="Always">
                                                <input type="checkbox" name="source_of_awareness" value="School">
                                                <input name="source_other">
                                            </div>
                                            <button type="button" class="btn btn-primary px-5"
                                                onclick="saveSection('E')">Save</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section F: Critical Ocular Data -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingF">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapseF">
                                            <div class="d-flex align-items-center">
                                                <div class="rounded-circle text-danger d-flex align-items-center justify-content-center me-3"
                                                    style="width: 36px; height: 36px; color: var(--accent-color); background: var(--accent-light);">
                                                    <i class="bi bi-eye-fill"></i>
                                                </div>
                                                <span>Section F: Ocular Examination</span>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapseF" class="accordion-collapse collapse"
                                        data-bs-parent="#myopiaFormAccordion">
                                        <div class="accordion-body bg-white p-4">
                                            <div class="row g-4">
                                                <div class="col-md-6">
                                                    <label class="form-label">37. Uncorrected Visual Acuity</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="uncorrected_visual_acuity_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="uncorrected_visual_acuity_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">38. Best Corrected Visual
                                                        Acuity</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="best_corrected_visual_acuity_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="best_corrected_visual_acuity_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">39. Cycloplegic Refraction</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="cycloplegic_refraction_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="cycloplegic_refraction_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">40. Axial Length</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="axial_length_right_eye" placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="axial_length_left_eye" placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">41. Keratometry</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="keratometry_right_eye" placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="keratometry_left_eye" placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">42. Anterior Chamber Depth</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="anterior_chamber_depth_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="anterior_chamber_depth_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">43. Lens Thickness</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="lens_thickness_right_eye" placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="lens_thickness_left_eye" placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">44. Central Corneal Thickness</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="central_corneal_thickness_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="central_corneal_thickness_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">45. Intraocular Pressure</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="intraocular_pressure_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="intraocular_pressure_left_eye" placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">46. Retinal Thickness (Macular)</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="retinal_thickness_macular_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="retinal_thickness_macular_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">47. Choroidal Thickness
                                                        (Macular)</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="choroidal_thickness_macular_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="choroidal_thickness_macular_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">48. Peripapillary RNFL
                                                        Thickness</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control"
                                                            name="peripapillary_rnfl_thickness_right_eye"
                                                            placeholder="Right Eye">
                                                        <input type="text" class="form-control"
                                                            name="peripapillary_rnfl_thickness_left_eye"
                                                            placeholder="Left Eye">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                                                <button type="button" class="btn btn-primary px-5"
                                                    onclick="saveSection('F')">Save Progress</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                        </div> <!-- End Accordion -->

                        <div id="formSubmitBtnContainer" class="d-grid gap-2 mt-5" style="display:none;">
                            <button class="btn btn-success btn-lg shadow py-3 fw-bold fs-6" type="submit"
                                onclick="submitForm()">
                                <i class="bi bi-check-circle-fill me-2"></i> Submit Final Data
                            </button>
                        </div>
                        </form>
                    </div>
                </div>
        </div>

        <!-- Success State -->
        <div id="formsSuccessState" style="display: none;">
            <div class="text-center py-5">
                <div class="display-1 text-success mb-3"><i class="bi bi-check-circle"></i></div>
                <h2 class="fw-bold mb-2">Submitted Successfully!</h2>
                <p class="text-muted fs-5">Data has been securely recorded.</p>
                <div class="bg-white border rounded-4 p-4 d-inline-block my-5 shadow-sm">
                    <small class="text-uppercase text-muted fw-bold">Reference ID</small>
                    <div class="fs-2 fw-bold text-dark mt-1" id="successFormId">#FM-0000</div>
                </div>
                <br>
                <button class="btn btn-outline-primary px-5 me-2 py-3" onclick="switchFormState('list')">Return
                    to List</button>
                <button class="btn btn-primary px-5 py-3" onclick="switchFormState('entry')">Submit
                    Another</button>
            </div>
        </div>
        </section>

        <!-- ===================== FOLLOW-UPS ===================== -->
        <section id="followups" class="spa-section">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <div>
                    <h2 class="section-title mb-2">Follow-Up Management</h2>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#"
                                        onclick="showSection('dashboard', document.getElementById('dashboard-nav'))">Dashboard</a>
                                </li>
                                <li class="breadcrumb-item active">Follow-Ups</li>
                            </ol>
                        </nav>
                </div>
                <button class="btn btn-primary shadow-sm" onclick="openNewFollowup()">
                    <i class="bi bi-plus-lg me-2"></i>New Follow-Up
                </button>
            </div>

            <!-- Follow-Up Management Overview -->
            <div class="alert alert-info border-0 bg-soft-blue mb-4">
                <div class="d-flex align-items-center">
                    <i class="bi bi-calendar-check text-primary fs-4 me-3"></i>
                    <div>
                        <h6 class="mb-1 text-primary fw-bold">Efficient Follow-Up Tracking</h6>
                        <p class="mb-0 small">Monitor all scheduled follow-ups, clearly distinguishing between due and overdue appointments. Utilize filtering by date and clinician to manage workload, and override follow-up statuses as needed to reflect real-world progress.</p>
                    </div>
                </div>
            </div>

            <div class="card border-0 bg-transparent shadow-none">
                <div class="card mb-5 border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-end-0 ps-3"><i
                                            class="bi bi-search text-muted"></i></span>
                                    <input type="text" id="followupSearchInput"
                                        class="form-control border-start-0 bg-white shadow-none"
                                        placeholder="Search student...">
                                </div>
                            </div>
                            <div class="col-md-7 text-end">
                                <div class="row g-3 justify-content-end">
                                    <div class="col-md-4">
                                        <select id="followupClinicianFilter" class="form-select">
                                            <option value="">All Clinicians</option>
                                            <!-- Populated by JS -->
                                        </select>
                                    </div>
                                    <div class="col-md-auto">
                                        <button class="btn btn-white border shadow-sm" onclick="applyFollowupFilters()"><i
                                            class="bi bi-arrow-clockwise me-2"></i> Refresh</button>
                                    </div>
                                </div>
                                <!-- Hidden inputs for JS compat -->
                                <input type="hidden" id="followupDateFromFilter">
                                <input type="hidden" id="followupDateToFilter">
                                <input type="hidden" id="followupDateFilter">
                                <input type="hidden" id="followupStatusFilter">
                                <input type="hidden" id="followupSchoolFilter">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-custom" id="followupsTable">
                        <thead>
                            <tr>
                                <th class="ps-4">ID</th>
                                <th>Student Name</th>
                                <th>School</th>
                                <th>Last Visit</th>
                                <th>Status</th>
                                <th class="text-end pe-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- JS Populated -->
                        </tbody>
                    </table>
                </div>

                <div class="d-flex justify-content-between align-items-center mt-4">
                    <small class="text-muted fw-medium" id="followupPaginationInfo">Showing 0</small>
                    <div class="btn-group shadow-sm">
                        <button class="btn btn-white border px-3" id="followupPrevBtn"
                            onclick="prevFollowupPage()">Prev</button>
                        <button class="btn btn-white border px-3" id="followupNextBtn"
                            onclick="nextFollowupPage()">Next</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===================== USERS ===================== -->
        <section id="users" class="spa-section">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <div>
                    <h2 class="section-title mb-2">User Management</h2>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#"
                                        onclick="showSection('dashboard', document.getElementById('dashboard-nav'))">Dashboard</a>
                                </li>
                                <li class="breadcrumb-item active">Users</li>
                            </ol>
                        </nav>
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal" style="display: none;">
                    <i class="bi bi-plus-lg"></i> Add User
                </button>
            </div>

            <!-- User Management Actions -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4">
                    <h5 class="fw-bold text-dark mb-3">User Management Actions</h5>
                    <p class="text-muted small">Perform administrative tasks related to user accounts. Create new users, manage account status, reset passwords, and monitor user activity.</p>
                    <div class="d-flex flex-wrap gap-3">
                        <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                            <i class="bi bi-person-plus me-2"></i>Create New User
                        </button>
                        <button class="btn btn-outline-success" onclick="bulkActivateUsers()">
                            <i class="bi bi-check-circle me-2"></i>Activate Accounts
                        </button>
                        <button class="btn btn-outline-warning" onclick="bulkDeactivateUsers()">
                            <i class="bi bi-x-circle me-2"></i>Block Accounts
                        </button>
                        <button class="btn btn-outline-secondary" onclick="bulkResetPasswords()">
                            <i class="bi bi-key me-2"></i>Reset Passwords
                        </button>
                        <button class="btn btn-outline-danger" onclick="bulkForceLogout()">
                            <i class="bi bi-box-arrow-right me-2"></i>Force Logout
                        </button>
                    </div>
                </div>
            </div>

            <!-- User Statistics -->
            <div class="row g-4 mb-4">
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="bg-primary bg-opacity-10 rounded-circle p-3 d-inline-flex mb-3">
                                <i class="bi bi-people-fill text-primary fs-4"></i>
                            </div>
                            <h4 class="fw-bold text-dark mb-1" id="totalUsersCount">--</h4>
                            <small class="text-muted">Total Users</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="bg-success bg-opacity-10 rounded-circle p-3 d-inline-flex mb-3">
                                <i class="bi bi-check-circle-fill text-success fs-4"></i>
                            </div>
                            <h4 class="fw-bold text-dark mb-1" id="activeUsersCount">--</h4>
                            <small class="text-muted">Active Users</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="bg-warning bg-opacity-10 rounded-circle p-3 d-inline-flex mb-3">
                                <i class="bi bi-pause-circle-fill text-warning fs-4"></i>
                            </div>
                            <h4 class="fw-bold text-dark mb-1" id="inactiveUsersCount">--</h4>
                            <small class="text-muted">Inactive Users</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="bg-danger bg-opacity-10 rounded-circle p-3 d-inline-flex mb-3">
                                <i class="bi bi-x-circle-fill text-danger fs-4"></i>
                            </div>
                            <h4 class="fw-bold text-dark mb-1" id="blockedUsersCount">--</h4>
                            <small class="text-muted">Blocked Users</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Table -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom-0 py-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-dark">User Accounts</h5>
                        <div class="d-flex gap-2">
                            <input type="text" class="form-control form-control-sm" placeholder="Search users..." id="userSearchInput" style="width: 200px;">
                            <select class="form-select form-select-sm" id="userStatusFilter" style="width: 120px;">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="blocked">Blocked</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-custom mb-0" id="usersTable">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-4" style="width: 40px;">
                                        <input type="checkbox" id="selectAllUsersCheckbox">
                                    </th>
                                    <th class="ps-4">Username</th>
                                    <th>Full Name</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Joined</th>
                                    <th>Last Login</th>
                                    <th class="text-end pe-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Sample user data -->
                                <tr>
                                    <td class="ps-4">
                                        <input type="checkbox" class="user-checkbox" value="1">
                                    </td>
                                    <td class="ps-4 fw-medium">dr.smith</td>
                                    <td>Dr. Sarah Johnson</td>
                                    <td>
                                        <span class="badge bg-primary bg-opacity-10 text-primary">Administrator</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-success">Active</span>
                                    </td>
                                    <td class="small text-muted">Jan 15, 2024</td>
                                    <td class="small text-muted">2 hours ago</td>
                                    <td class="text-end pe-4">
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                                Actions
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="#" onclick="viewUserDetails(1)">
                                                    <i class="bi bi-eye me-2"></i>View Details</a></li>
                                                <li><a class="dropdown-item" href="#" onclick="editUser(1)">
                                                    <i class="bi bi-pencil me-2"></i>Edit User</a></li>
                                                <li><a class="dropdown-item" href="#" onclick="resetUserPassword(1)">
                                                    <i class="bi bi-key me-2"></i>Reset Password</a></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item text-warning" href="#" onclick="deactivateUser(1)">
                                                    <i class="bi bi-pause-circle me-2"></i>Deactivate</a></li>
                                                <li><a class="dropdown-item text-danger" href="#" onclick="blockUser(1)">
                                                    <i class="bi bi-x-circle me-2"></i>Block Account</a></li>
                                                <li><a class="dropdown-item text-danger" href="#" onclick="deleteUser(1)">
                                                    <i class="bi bi-trash me-2"></i>Delete User</a></li>
                                                <li><a class="dropdown-item text-danger" href="#" onclick="forceLogoutUser(1)">
                                                    <i class="bi bi-box-arrow-right me-2"></i>Force Logout</a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="ps-4">
                                        <input type="checkbox" class="user-checkbox" value="2">
                                    </td>
                                    <td class="ps-4 fw-medium">dr.brown</td>
                                    <td>Dr. Michael Brown</td>
                                    <td>
                                        <span class="badge bg-info bg-opacity-10 text-info">Clinician</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-success">Active</span>
                                    </td>
                                    <td class="small text-muted">Feb 20, 2024</td>
                                    <td class="small text-muted">1 day ago</td>
                                    <td class="text-end pe-4">
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                                Actions
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="#" onclick="viewUserDetails(2)">
                                                    <i class="bi bi-eye me-2"></i>View Details</a></li>
                                                <li><a class="dropdown-item" href="#" onclick="editUser(2)">
                                                    <i class="bi bi-pencil me-2"></i>Edit User</a></li>
                                                <li><a class="dropdown-item" href="#" onclick="resetUserPassword(2)">
                                                    <i class="bi bi-key me-2"></i>Reset Password</a></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item text-warning" href="#" onclick="deactivateUser(2)">
                                                    <i class="bi bi-pause-circle me-2"></i>Deactivate</a></li>
                                                <li><a class="dropdown-item text-danger" href="#" onclick="blockUser(2)">
                                                    <i class="bi bi-x-circle me-2"></i>Block Account</a></li>
                                                <li><a class="dropdown-item text-danger" href="#" onclick="forceLogoutUser(2)">
                                                    <i class="bi bi-box-arrow-right me-2"></i>Force Logout</a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="ps-4">
                                        <input type="checkbox" class="user-checkbox" value="3">
                                    </td>
                                    <td class="ps-4 fw-medium">data.entry1</td>
                                    <td>Jane Wilson</td>
                                    <td>
                                        <span class="badge bg-secondary bg-opacity-10 text-secondary">Data Entry</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-warning">Inactive</span>
                                    </td>
                                    <td class="small text-muted">Mar 10, 2024</td>
                                    <td class="small text-muted">1 week ago</td>
                                    <td class="text-end pe-4">
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                                Actions
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="#" onclick="viewUserDetails(3)">
                                                    <i class="bi bi-eye me-2"></i>View Details</a></li>
                                                <li><a class="dropdown-item" href="#" onclick="editUser(3)">
                                                    <i class="bi bi-pencil me-2"></i>Edit User</a></li>
                                                <li><a class="dropdown-item" href="#" onclick="resetUserPassword(3)">
                                                    <i class="bi bi-key me-2"></i>Reset Password</a></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item text-success" href="#" onclick="activateUser(3)">
                                                    <i class="bi bi-play-circle me-2"></i>Activate</a></li>
                                                <li><a class="dropdown-item text-danger" href="#" onclick="blockUser(3)">
                                                    <i class="bi bi-x-circle me-2"></i>Block Account</a></li>
                                                <li><a class="dropdown-item text-danger" href="#" onclick="forceLogoutUser(3)">
                                                    <i class="bi bi-box-arrow-right me-2"></i>Force Logout</a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="ps-4">
                                        <input type="checkbox" class="user-checkbox" value="4">
                                    </td>
                                    <td class="ps-4 fw-medium">dr.davis</td>
                                    <td>Dr. Emily Davis</td>
                                    <td>
                                        <span class="badge bg-info bg-opacity-10 text-info">Clinician</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-danger">Blocked</span>
                                    </td>
                                    <td class="small text-muted">Jan 5, 2024</td>
                                    <td class="small text-muted">2 weeks ago</td>
                                    <td class="text-end pe-4">
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                                Actions
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="#" onclick="viewUserDetails(4)">
                                                    <i class="bi bi-eye me-2"></i>View Details</a></li>
                                                <li><a class="dropdown-item" href="#" onclick="editUser(4)">
                                                    <i class="bi bi-pencil me-2"></i>Edit User</a></li>
                                                <li><a class="dropdown-item" href="#" onclick="resetUserPassword(4)">
                                                    <i class="bi bi-key me-2"></i>Reset Password</a></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item text-success" href="#" onclick="activateUser(4)">
                                                    <i class="bi bi-play-circle me-2"></i>Activate</a></li>
                                                <li><a class="dropdown-item text-warning" href="#" onclick="deactivateUser(4)">
                                                    <i class="bi bi-pause-circle me-2"></i>Deactivate</a></li>
                                                <li><a class="dropdown-item text-danger" href="#" onclick="forceLogoutUser(4)">
                                                    <i class="bi bi-box-arrow-right me-2"></i>Force Logout</a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-white border-top-0 py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-3">
                            <small class="text-muted fw-medium" id="userPaginationInfo">Showing 4 users</small>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    Bulk Actions
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="bulkActivateSelected()">
                                        <i class="bi bi-check-circle me-2"></i>Activate Selected</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="bulkDeactivateSelected()">
                                        <i class="bi bi-pause-circle me-2"></i>Deactivate Selected</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="bulkBlockSelected()">
                                        <i class="bi bi-x-circle me-2"></i>Block Selected</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="bulkResetPasswordsSelected()">
                                        <i class="bi bi-key me-2"></i>Reset Passwords</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="bulkForceLogoutSelected()">
                                        <i class="bi bi-box-arrow-right me-2"></i>Force Logout</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="btn-group shadow-sm">
                            <button class="btn btn-white border px-3" id="userPrevBtn" onclick="prevUserPage()"><i class="bi bi-chevron-left"></i></button>
                            <button class="btn btn-white border px-3" id="userNextBtn" onclick="nextUserPage()"><i class="bi bi-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===================== REPORTS / EXPORT ===================== -->
        <section id="reports" class="spa-section">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <div>
                    <h2 class="section-title mb-2">Reports & Data Export</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#"
                                    onclick="showSection('dashboard', document.getElementById('dashboard-nav'))">Dashboard</a>
                            </li>
                            <li class="breadcrumb-item active">Reports</li>
                        </ol>
                    </nav>
                </div>
            </div>

            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4">
                    <h5 class="fw-bold text-dark mb-3">Export Options</h5>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="exportFormat" class="form-label small fw-bold">Export Format</label>
                            <select class="form-select" id="exportFormat">
                                <option value="csv">CSV (Comma Separated Values)</option>
                                <option value="excel">Excel (XLSX)</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">Date Range (From)</label>
                            <input type="date" class="form-control" id="exportDateFrom">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">Date Range (To)</label>
                            <input type="date" class="form-control" id="exportDateTo">
                        </div>
                        <div class="col-12">
                            <label class="form-label small fw-bold">Select Sections for Export</label>
                            <div class="d-flex flex-wrap gap-3">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="sectionA" value="A" checked>
                                    <label class="form-check-label" for="sectionA">Section A (Demographics)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="sectionB" value="B" checked>
                                    <label class="form-check-label" for="sectionB">Section B (Behavioral & Lifestyle)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="sectionC" value="C" checked>
                                    <label class="form-check-label" for="sectionC">Section C (Environmental Factors)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="sectionD" value="D" checked>
                                    <label class="form-check-label" for="sectionD">Section D (Clinical History)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="sectionE" value="E" checked>
                                    <label class="form-check-label" for="sectionE">Section E (Awareness & Safety)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="sectionF" value="F" checked>
                                    <label class="form-check-label" for="sectionF">Section F (Ocular Examination)</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 mt-4">
                            <button class="btn btn-primary btn-lg" onclick="downloadCleanDataset()">
                                <i class="bi bi-download me-2"></i>Download Clean Dataset
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===================== SETTINGS ===================== -->
        <section id="settings" class="spa-section">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <div>
                    <h2 class="section-title mb-2">Settings</h2>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#"
                                        onclick="showSection('dashboard', document.getElementById('dashboard-nav'))">Dashboard</a>
                                </li>
                                <li class="breadcrumb-item active">Settings</li>
                            </ol>
                        </nav>
                </div>
            </div>

            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <p>Settings content here.</p>
                </div>
            </div>
        </section>

    </div> <!-- End Content -->
    </div> <!-- End Wrapper -->


    <!-- ===================== MODALS & OVERLAYS ===================== -->



    <!-- Add Admin Modal -->
    <div class="modal fade" id="addAdminModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content border-danger">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title fw-bold"><i class="bi bi-shield-lock me-2"></i>Create New Admin</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning small mb-3">
                        <i class="bi bi-exclamation-triangle me-1"></i>
                        Admins have <strong>full access</strong> to modify, delete, and export all system data.
                    </div>
                    <form id="createAdminForm" onsubmit="handleCreateAdmin(event)">

                        <div class="mb-3">
                            <label class="form-label small fw-bold">Admin Username</label>
                            <input type="text" name="username" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold">Email Address</label>
                            <input type="email" name="email" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold">Password</label>
                            <input type="password" name="password" class="form-control" required>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-danger">Grant Admin Access</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Reset Password Modal -->
    <div class="modal fade" id="resetPasswordModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title fw-bold"><i class="bi bi-key me-2"></i>Reset User Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning small mb-3">
                        <i class="bi bi-exclamation-triangle me-1"></i>
                        This will force a password reset for <strong id="resetPasswordUsername"></strong>.
                        The user will need to log in with the new password.
                    </div>
                    <form id="resetPasswordForm" onsubmit="handleResetPassword(event)">
                        <input type="hidden" id="resetPasswordUserId" name="userId">
                        <div class="mb-3">
                            <label class="form-label small fw-bold">New Password</label>
                            <input type="password" name="new_password" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold">Confirm New Password</label>
                            <input type="password" name="confirm_password" class="form-control" required>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning">Reset Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Override Modal -->
    <div class="modal fade" id="adminOverrideModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title fw-bold"><i class="bi bi-gear me-2"></i>Admin Overrides</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="adminOverrideForm" onsubmit="handleAdminOverride(event)">
                        <input type="hidden" id="overrideUserId" name="userId">
                        <p class="text-muted small mb-3">Performing actions for user: <strong id="overrideUsername"></strong></p>
                        
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="userActiveToggle">
                            <label class="form-check-label" for="userActiveToggle">Account Active</label>
                            <small class="form-text text-muted">Toggle to activate or deactivate the user account.</small>
                        </div>

                        <hr>

                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <button type="button" class="btn btn-outline-danger" onclick="forceLogoutUser()">
                                <i class="bi bi-box-arrow-right me-2"></i>Force Logout
                            </button>
                            <small class="form-text text-muted ms-3">Invalidates all active sessions for this user.</small>
                        </div>

                        <hr>
                        
                        <div class="d-flex justify-content-end mt-4">
                            <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Review Overlay (Custom) -->
    <div id="popupInline" class="review-overlay">
        <div class="review-box">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="fw-bold mb-0">Review Responses</h5>
                <button type="button" class="btn-close" onclick="closeReview()"></button>
            </div>
            <div id="reviewContent" class="mb-4"></div>
            <div class="d-flex justify-content-end gap-2">
                <button class="btn btn-outline-secondary" onclick="editForm()">Edit</button>
                <button class="btn btn-success" onclick="finalSubmit()">Confirm Submission</button>
            </div>
        </div>
    </div>

    <!-- FollowUp Modal (Bootstrap) -->
    <div class="modal fade" id="followupModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-white border-bottom-0 pb-0">
                    <div>
                        <h5 class="modal-title fw-bold text-dark" id="followupModalTitle">New Follow-Up</h5>
                        <p class="text-muted small m-0">Enter the latest clinical findings for the patient.</p>
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body bg-light">
                    <form id="followupForm">
                        <div class="card mb-4 border-0 shadow-sm">
                            <div class="card-body">
                                <h6 class="fw-bold text-muted mb-3 text-uppercase small">Visit Details</h6>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label">Student ID</label>
                                        <input type="text" class="form-control" name="fuStudentId" id="fuStudentId"
                                            required>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Visit Date</label>
                                        <input type="date" class="form-control" name="fuVisitDate" id="fuLastVisit"
                                            required>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Next Visit</label>
                                        <input type="date" class="form-control" name="fuNextVisit" id="fuNextVisit"
                                            required>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h6 class="fw-bold text-muted mb-3 text-uppercase small">Clinical Data</h6>
                                <div class="row g-4">
                                    <!-- Uncorrected VA -->
                                    <div class="col-md-6">
                                        <label class="form-label">Uncorrected Visual Acuity</label>
                                        <div class="input-group">
                                            <input type="text" name="ucva_re" class="form-control"
                                                placeholder="Right Eye (OD)">
                                            <input type="text" name="ucva_le" class="form-control"
                                                placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Best Corrected VA -->
                                    <div class="col-md-6">
                                        <label class="form-label">Best Corrected Visual Acuity</label>
                                        <div class="input-group">
                                            <input type="text" name="bcva_re" class="form-control"
                                                placeholder="Right Eye (OD)">
                                            <input type="text" name="bcva_le" class="form-control"
                                                placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Cycloplegic SE -->
                                    <div class="col-md-6">
                                        <label class="form-label">Cycloplegic Refraction (SE)</label>
                                        <div class="input-group">
                                            <input type="text" name="cyclo_se_re" class="form-control"
                                                placeholder="Right Eye (OD)">
                                            <input type="text" name="cyclo_se_le" class="form-control"
                                                placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Axial Length -->
                                    <div class="col-md-6">
                                        <label class="form-label">Axial Length (mm)</label>
                                        <div class="input-group">
                                            <input type="text" name="axial_length_re" class="form-control"
                                                placeholder="Right Eye (OD)">
                                            <input type="text" name="axial_length_le" class="form-control"
                                                placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Keratometry -->
                                    <div class="col-md-6">
                                        <label class="form-label">Keratometry (K1/K2)</label>
                                        <div class="input-group">
                                            <input type="text" name="keratometry_re" class="form-control"
                                                placeholder="Right Eye (OD)">
                                            <input type="text" name="keratometry_le" class="form-control"
                                                placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Central Corneal Thickness -->
                                    <div class="col-md-6">
                                        <label class="form-label">Central Corneal Thickness (Î¼m)</label>
                                        <div class="input-group">
                                            <input type="text" name="cct_re" class="form-control"
                                                placeholder="Right Eye (OD)">
                                            <input type="text" name="cct_le" class="form-control"
                                                placeholder="Left Eye (OS)">
                                        </div>
                                    </div>
                                    <!-- Anterior Segment -->
                                    <div class="col-md-6">
                                        <label class="form-label">Anterior Segment Findings</label>
                                        <textarea name="anterior_segment_re" class="form-control" rows="2"
                                            placeholder="Right Eye (OD)"></textarea>
                                        <textarea name="anterior_segment_le" class="form-control mt-2" rows="2"
                                            placeholder="Left Eye (OS)"></textarea>
                                    </div>
                                    <!-- Fundus Findings -->
                                    <div class="col-md-6">
                                        <label class="form-label">Fundus Findings</label>
                                        <textarea name="fundus_findings_re" class="form-control" rows="2"
                                            placeholder="Right Eye (OD)"></textarea>
                                        <textarea name="fundus_findings_le" class="form-control mt-2" rows="2"
                                            placeholder="Left Eye (OS)"></textarea>
                                    </div>
                                    <!-- Amblyopia or Strabismus -->
                                    <div class="col-12">
                                        <label class="form-label d-block">Amblyopia or Strabismus Present</label>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="amblyopia_or_strabismus"
                                                id="amblyopiaYes" value="true">
                                            <label class="form-check-label" for="amblyopiaYes">Yes</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="amblyopia_or_strabismus"
                                                id="amblyopiaNo" value="false" checked>
                                            <label class="form-check-label" for="amblyopiaNo">No</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-none">
                                    <input name="spherical_re"><input name="spherical_le">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer bg-white border-top-0">
                    <button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-info text-white" onclick="reviewFollowup()">Review</button>
                    <button class="btn btn-primary" id="followupSubmitBtn">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Followup Review Overlay -->
    <div id="followupReviewOverlay" class="review-overlay">
        <div class="review-box">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="fw-bold mb-0">Review Follow-Up</h5>
                <button type="button" class="btn-close" onclick="closeFollowupReview()"></button>
            </div>
            <div id="followupReviewContent" class="small mb-3"></div>
            <div class="d-flex justify-content-end gap-2">
                <button class="btn btn-outline-secondary btn-sm" onclick="editFollowup()">Edit</button>
                <button class="btn btn-success btn-sm" id="followupFinalSubmitBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="addUserForm" onsubmit="handleCreateUser(event)">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" name="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="fullname" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="fullname" name="fullname" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" name="password" required>
                        </div>
                        <div class="mb-3">
                            <label for="role" class="form-label">Role</label>
                            <select class="form-select" id="role" name="role" required>
                                <option value="Data Entry">Data Entry</option>
                                <option value="User">User</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>



    <!-- Student Modal -->
    <div class="modal fade" id="studentModal" tabindex="-1" aria-labelledby="studentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studentModalLabel">Student Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="studentModalBody">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editStudentModalLabel">Edit Student</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="editStudentForm" onsubmit="saveStudentEdits()">
                    <div class="modal-body">
                        <input type="hidden" id="editStudentId">
                        <div class="mb-3">
                            <label for="editName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="editName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editAge" class="form-label">Age</label>
                            <input type="number" class="form-control" id="editAge" required>
                        </div>
                        <div class="mb-3">
                            <label for="editGender" class="form-label">Gender</label>
                            <select class="form-select" id="editGender" required>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editSchool" class="form-label">School</label>
                            <input type="text" class="form-control" id="editSchool" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Student Modal -->
    <div class="modal fade" id="deleteStudentModal" tabindex="-1" aria-labelledby="deleteStudentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteStudentModalLabel">Delete Student</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete <strong id="deleteStudentName"></strong>?</p>
                    <input type="hidden" id="deleteStudentId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteStudent()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Merge Duplicates Modal -->
    <div class="modal fade" id="mergeDuplicatesModal" tabindex="-1" aria-labelledby="mergeDuplicatesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mergeDuplicatesModalLabel">Merge Duplicate Records</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        Select the primary record to keep for each group of duplicates. All other records will be merged into the selected primary record.
                    </div>
                    <div class="table-responsive">
                        <table class="table table-borderless">
                            <thead>
                                <tr>
                                    <th>Duplicate Records</th>
                                    <th>School</th>
                                    <th>Age/Gender</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="duplicatesBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="confirmAllMerges()">Merge All Selected</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Profile Modal -->
    <div class="modal fade" id="studentProfileModal" tabindex="-1" aria-labelledby="studentProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studentProfileModalLabel">Student Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4 text-center mb-4">
                            <img src="https://ui-avatars.com/api/?name=Student&background=0ea5e9&color=fff&size=128"
                                class="rounded-circle mb-3" width="80" height="80">
                            <h5 id="profileName">Student Name</h5>
                            <p class="text-muted mb-1" id="profileId">ID: STU001</p>
                            <span class="badge" id="profileStatus">Active</span>
                        </div>
                        <div class="col-md-8">
                            <div class="row g-3">
                                <div class="col-sm-6">
                                    <label class="form-label small fw-bold">Age</label>
                                    <p class="mb-0" id="profileAge">14</p>
                                </div>
                                <div class="col-sm-6">
                                    <label class="form-label small fw-bold">Gender</label>
                                    <p class="mb-0" id="profileGender">Female</p>
                                </div>
                                <div class="col-sm-6">
                                    <label class="form-label small fw-bold">School</label>
                                    <p class="mb-0" id="profileSchool">Lincoln High School</p>
                                </div>
                                <div class="col-sm-6">
                                    <label class="form-label small fw-bold">Created By</label>
                                    <p class="mb-0" id="profileCreatedBy">Dr. Smith</p>
                                </div>
                                <div class="col-sm-6">
                                    <label class="form-label small fw-bold">Last Visit</label>
                                    <p class="mb-0" id="profileLastVisit">2024-01-15</p>
                                </div>
                                <div class="col-sm-6">
                                    <label class="form-label small fw-bold">Total Visits</label>
                                    <p class="mb-0" id="profileTotalVisits">3</p>
                                </div>
                                <div class="col-sm-6">
                                    <label class="form-label small fw-bold">Next Visit</label>
                                    <p class="mb-0" id="profileNextVisit">2024-02-15</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <div class="row">
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">Follow-up History</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="profileFollowups">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="editStudent(document.getElementById('profileId').textContent.split(': ')[1])">Edit Profile</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Search Modal -->
    <div class="modal fade" id="globalSearchModal" tabindex="-1" aria-labelledby="globalSearchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="globalSearchModalLabel">Search Results</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="globalSearchResults">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <form id="logoutForm" method="POST" action="login.html" class="d-none"></form>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="static/js/admin_dash.js"></script>
</body>

</html>